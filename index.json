[{"categories":["DevOps"],"content":"1. Introduction Ansible is a Python-based automation tool that manages nodes over SSH and uses YAML to describe configurations. It has features like being agentless, efficient, and simple. Ansible is commonly used for automation deployment, configuration management, etc. ","date":"2023-08-03","objectID":"/ansible-note/:1:0","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"2. Installation \u0026 Configuration ","date":"2023-08-03","objectID":"/ansible-note/:2:0","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"2.1. Install Ansible # MacOS \u003e brew install ansible # CentOS \u003e yum install epel-release \u003e yum repolist \u003e yum install ansible -y # Ubuntu \u003e sudo apt-add-repository ppa:ansible/ansible \u003e sudo apt-get update \u003e sudo apt-get install ansible # Pip \u003e pip install ansible ","date":"2023-08-03","objectID":"/ansible-note/:2:1","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"2.2. Configure Ansible Edit the /etc/ansible/ansible.cfg file for configuration. E.g. define the inventory file, enable logging, etc. ","date":"2023-08-03","objectID":"/ansible-note/:2:2","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"3. Common Modules Some common Ansible modules: command - Execute commands copy - Copy files shell - Execute scripts yum - Package management service - Manage services Use ansible-doc -l to see all modules. ","date":"2023-08-03","objectID":"/ansible-note/:3:0","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4. Snippets ","date":"2023-08-03","objectID":"/ansible-note/:4:0","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.1. Remote copy - name: copy file to the target host copy: src: filename dest: /usr/local/src/ ","date":"2023-08-03","objectID":"/ansible-note/:4:1","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.2. yum - name: install dependencies yum: name: - gcc-c++ - pcre - pcre-devel - zlib - zlib-devel - openssl - openssl-devel state: present ","date":"2023-08-03","objectID":"/ansible-note/:4:2","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.3. Execute shell - name: shell shell: make \u0026\u0026 make install args: chdir: /usr/local/src/ - name: set script permissions shell: chmod +x /etc/profile.d/start-tomcat.sh args: chdir: /usr/local/src/mysql_secure_installation.sh - name: execute mysql_secure_installation.sh shell: sh mysql_secure_installation.sh args: chdir: /usr/local/src/ ","date":"2023-08-03","objectID":"/ansible-note/:4:3","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.4. file - name: create directory if it does not exist file: path: /var/www/html/yumrepository state: directory mode: '0755' - name: create a symlink for keystone virtual host config file: src: /usr/share/keystone/wsgi-keystone.conf dest: /etc/httpd/conf.d/wsgi-keystone.conf state: link ","date":"2023-08-03","objectID":"/ansible-note/:4:4","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.5. service - name: start nginx shell: 'nohup /usr/local/nginx/sbin/nginx \u0026' - name: reload service systemd: daemon-reload: yes - name: start and enable elasticsearch on boot service: name: elasticsearch state: started enabled: yes - name: wait for elasticsearch to start wait_for: port: 9200 delay: 10 - name: start service httpd if not started service: name: httpd state: started - name: stop service httpd if started service: name: httpd state: stopped - name: restart service httpd in all cases service: name: httpd state: restarted - name: reload service httpd in all cases service: name: httpd state: reloaded - name: enable httpd service , don't touch state service: name: httpd enabled: yes - name: start service foo based on running process service: name: foo pattern: /usr/bin/foo state: started - name: restart network service for interface eth0 service: name: network state: restarted args: eth0 ","date":"2023-08-03","objectID":"/ansible-note/:4:5","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.6. Variables # register shell result as variable - name: verify installation shell: docker version register: dockerVersion - name: print docker version debug: var: dockerVersion # check if file exists - name: register file info stat: path: \"/tmp/test_file\" register: file_path - name: create file if it doesn't exist file: path: \"/tmp/test_file\" state: touch when: file_path.stat.exists == False ","date":"2023-08-03","objectID":"/ansible-note/:4:6","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.7. environment - name: check shell: openstack token issue register: openstack_token_issue environment: OS_PROJECT_DOMAIN_NAME: Default OS_USER_DOMAIN_NAME: Default OS_PROJECT_NAME: admin OS_USERNAME: admin OS_PASSWORD: admin OS_AUTH_URL: http://192.168.0.101:5000/v3 OS_IDENTITY_API_VERSION: 3 OS_IMAGE_API_VERSION: 2 tags: - debug ","date":"2023-08-03","objectID":"/ansible-note/:4:7","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.8. template {{ yum_server_ip }} - name: generate /etc/etcd/etcd.conf template: src: etcd.conf.j2 dest: /etc/etcd/etcd.conf [all:vars] # yum server ip yum_server_ip=172.16.18.23 ","date":"2023-08-03","objectID":"/ansible-note/:4:8","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"4.9. tags - name: copy file to the target host template: src: CentOS-PrivateLocal.repo.j2 dest: /etc/yum.repos.d/CentOS-PrivateLocal.repo tags: - debug \u003e ansible-playbook -i hosts site.yml --tags=debug ","date":"2023-08-03","objectID":"/ansible-note/:4:9","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5. Common Errors ","date":"2023-08-03","objectID":"/ansible-note/:5:0","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5.1. notify does not execute If the source and target files are the same when copying config files, the copy command does not execute. If the copy command does not execute, the notify will not call the handler. The solution is to delete the existing config file first before copying. ","date":"2023-08-03","objectID":"/ansible-note/:5:1","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5.2. Environment variables do not take effect For non-login shells like Ansible remote execution, environment variables in /etc/profile and ~/.bash_profile are not loaded, only ~/.bashrc and /etc/bashrc are loaded. If commands requiring specific environment variables need to be executed in Ansible, source ~/.bash_profile beforehand or put the environment variables in ~/.bashrc. ","date":"2023-08-03","objectID":"/ansible-note/:5:2","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5.3. Ansible shell script does not work as expected Problem: - name: start skywalking shell: './startup.sh' args: executable: /bin/bash chdir: '/usr/local/skywalking/bin/' Ansible can execute normally and returns results, but actually does not start. It can start normally via SSH. Solution: - name: start skywalking shell: 'nohup ./startup.sh \u0026' args: executable: /bin/bash chdir: '/usr/local/skywalking/bin/' ","date":"2023-08-03","objectID":"/ansible-note/:5:3","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5.4. /usr/bin/python: not found Problem: \u003e fatal: [node1]: FAILED! =\u003e {\"changed\": false, \"module_stderr\": \"Shared connection to 192.168.100.111 closed.\\r\\n\", \"module_stdout\": \"/bin/sh: 1: /usr/bin/python: not found\\r\\n\", \"msg\": \"MODULE FAILURE\\nSee stdout/stderr for the exact error\", \"rc\": 127} Solution 1: Install python on the remote host Solution 2: ansible_python_interpreter=/usr/bin/python3 ","date":"2023-08-03","objectID":"/ansible-note/:5:4","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":["DevOps"],"content":"5.5. Ansible hangs for no reason Problem: Ansible may hang randomly at some step during execution, even though that step has actually finished. Solution: \u003e rm -rf ~/.ansible ","date":"2023-08-03","objectID":"/ansible-note/:5:5","tags":["Ansible","Automation"],"title":"Ansible Note","uri":"/ansible-note/"},{"categories":null,"content":"About me","date":"2019-08-02","objectID":"/about/","tags":null,"title":"About Me","uri":"/about/"},{"categories":null,"content":"Introduction Hello, Iâ€™m Libing Wang, a senior software engineer from mainland China. ","date":"2019-08-02","objectID":"/about/:1:0","tags":null,"title":"About Me","uri":"/about/"},{"categories":null,"content":"Experience and Passion With over 10 years of experience in programming, I am deeply passionate about technology and have been focusing on software development and system design. Apart from my professional work, I enjoy dedicating my free time to learning new knowledge and applying it through coding projects. My interests are diverse, but programming and exploring emerging technologies are what captivate me the most. ","date":"2019-08-02","objectID":"/about/:2:0","tags":null,"title":"About Me","uri":"/about/"},{"categories":null,"content":"Seeking Remote Opportunities Currently, I am actively seeking full-time remote job opportunities abroad. Working remotely not only allows me to spend more time with my family but also enables me to grow in an international environment and collaborate with world-class teams. I am eager to join exceptional international teams and contribute to creating outstanding software solutions! ","date":"2019-08-02","objectID":"/about/:3:0","tags":null,"title":"About Me","uri":"/about/"},{"categories":null,"content":"Contact Information If you have any relevant job openings, please feel free to reach out to me via: Email: wanglibing001@gmail.com LinkedIn: linkedin.com/in/wanglibing001 Thank you for your attention and support. ","date":"2019-08-02","objectID":"/about/:4:0","tags":null,"title":"About Me","uri":"/about/"}]