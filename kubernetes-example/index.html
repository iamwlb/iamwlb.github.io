<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Kubernetes Example - DevPro Insights</title><meta name=Description content="Focused on knowledge and innovation in software development."><meta property="og:title" content="Kubernetes Example"><meta property="og:description" content="添加cluster和context 环境说明 项 说明 kubernetes1 192.168.0.101 kubernetes2 192.168.0.102 mac-pro 笔者的笔记本电脑，用来添加Cluster和设置context 配置文件 kubernetes1 配置文件 ~/.kube/config 内容如下：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 apiVersion: v1 kind: Config clusters: - cluster: api-version: v1 certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URXpOVEUxTVZvWERUTXhNRGN4TXpFek5URTFNVm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1PcFJVRzFaZm5NClcwc1pHamtBZ0dJcTg0UDlwTzh6RGxnc2RHUWJtQ0FYNUN0d3Mza0VXZzJVYnlYZUhhNDhxV09NRTVpNHpsZHEKMDl2QXZkeitoWHVjOHE0c0xqRjhFdW5jaEJhd002T1YrY04wbHlEOE0xcEUwelRoenRhYnZUQllhVVNuZmovbgpjditrWUlDNUdQRDRMdjFTWXBYOTdSK2R2TzdGaVg0a0t1d1p4ZVVETHdmQmN4NVdXaEdIT0tBQ0lFdHU5bkRyCkJTbnV2dE9lQ0kwUktrdzQwQ2pnMjVlYzVsT01paW1lNmpFdW5IZ0VpSkhmM0FtaGpSa0tmNVdaS2UreEpweDEKYjhIUFAvUXVJVnZSQVViOFA2VThUdGlmbVFRc0ZOMFZVK3h1QmN1b250UXFGVXFxQSt3MUtGUDBMOGVseHFIQgpESGc4elhhYXJDOENBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRk9ucGtjVmR5cW9JdUplZGNVWE9KK0Y3R0ViRkNCcytlcVkKLzBaMUZqNjQxZTJqZC9MNU9LMVJYTXF6ZEhIUm5WaEtUeXJDcWhXR2RLc2VjMmRrU1VBanh1TC9vQ1B1NldDMApaYkFPQXNCMXZuZW5WUTN0Y2h6OWU3ZnZ2b0dRWUV4NnpsMEVlcHA2N09EYUZIbHhsUGxINnN1dXhRM0VUQW9NCmV5UStBbHF0N0pwT3dzNEZRM3BBY1BOc2ZzZ0ZGQkJ0cjlPbDBMQm1xZUpBazlUN01LdHZSYnE2dkRsMWVTdFQKc05jMkdNaXpxUjY1QnQxc1B6QjF1VjdFditLVElFd1g3Vm84Um15ZjMrQjkzanBicHgrVEk1dGxxUXN6ZExUdgpod3pDQnhvZDJpcE9wdjU1Sm9ycmNsZ0RuOHFobTlYWVJXTk4vM2IzdGd2R1MvK1lKK1E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K server: &#34;https://192.168.0.101:6443&#34; name: &#34;local&#34; contexts: - context: cluster: &#34;local&#34; user: &#34;kube-admin-local&#34; name: &#34;local&#34; current-context: &#34;local&#34; users: - name: &#34;kube-admin-local&#34; user: client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJQ2RkVkJSRG9IM2t3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE16VXhOVEZhRncwek1UQTNNVE14TkRFM016VmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTJVYUpHMEN0VmhhS0hSeExURnFwbjlNaUcrUG8KdlZ6UGxZcXg0MXBCNk1DMmc1cHJ1MjBvdEwxWmxITkRFL01PQzNNNTVibjR0RDFzZUF5MjQ1ZEEzQUV6cml0UgovUEhNRzF3Ky9ZTTZiOTFQajd3cUd5UUE1dUNPTE1WbUYxQm5JbTRrSlNQUlNvRDFsZHMzcWFZeGl5VlpOT1VDClpXckR6NDh4Ry8wcG5PNDZNRGFNZ0VWS2VDU0ZhNm0zYjFaR1FWcEpqVi9HdVQ2QzhwOExucVBST0QzbkF3OXkKa1JnVm92MnlodGFwZXR6aDdVV2tTWHM3Vk5Gei9hM3pMT3FjQUdJa0plLzNXQ29iMTBPVG5Rbmg1Mms4SmphSgpzUm9JN2RLMURXMS9nT3crZDNKK2RkU0hYQTlreXF6UkZlWXJzaitRQTJHcFdab3RXbEJoWHVQWEJRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFMejNNOWRxNzJvSENkSW16ODIzMXNuY0N6ZVI2QlFFQUhWOVlzR3RqSnl0Nm54UAo2bW1ORVE2eCtpSjhSenRHanVwb2Z2aGtwdS91VGZ0MUtYbm1yaHg5N1FQbWtqaXZSVnVoMGxjVE01aWVldXZSCmxONklqbzgwUVBuR2c5Q0tMWndONHZmTnBPbUg3a2J4VzJDOWJWVmRyb1VjQmZ3QmJ1ejFtQjNnVVVYYlovMlAKL3lsRStpTW5OQ0xseGtFYXMrZnpoL0VmTzVLRE8wY0xFMDJIaEV2WEI1WkFEZUViZzlRdHFMNkZwOW9pVTRYbgpXcTR5Z1llV2NLWndyZ0hWWXpaOXQ5RkdlQUNnM0FLWHdwcDhDN3lDSE1EUWpmcnBsQzI5QU1WN2RHWjZ4azI0CmxSU3JiRVA4NVF1M0tUOUZyS0NaY3E1OWd2bm0xUEREVHJLaVI4VT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMlVhSkcwQ3RWaGFLSFJ4TFRGcXBuOU1pRytQb3ZWelBsWXF4NDFwQjZNQzJnNXByCnUyMG90TDFabEhOREUvTU9DM001NWJuNHREMXNlQXkyNDVkQTNBRXpyaXRSL1BITUcxdysvWU02YjkxUGo3d3EKR3lRQTV1Q09MTVZtRjFCbkltNGtKU1BSU29EMWxkczNxYVl4aXlWWk5PVUNaV3JEejQ4eEcvMHBuTzQ2TURhTQpnRVZLZUNTRmE2bTNiMVpHUVZwSmpWL0d1VDZDOHA4TG5xUFJPRDNuQXc5eWtSZ1ZvdjJ5aHRhcGV0emg3VVdrClNYczdWTkZ6L2EzekxPcWNBR0lrSmUvM1dDb2IxME9UblFuaDUyazhKamFKc1JvSTdkSzFEVzEvZ093K2QzSisKZGRTSFhBOWt5cXpSRmVZcnNqK1FBMkdwV1pvdFdsQmhYdVBYQlFJREFRQUJBb0lCQUVXbDVxMWx2aXFxYnZ1Rgo1bDFEY3J4WTRjWXUrSnc2OUEvcnRibzdaSVZId1RuT2RscE9VNDRjWkdyQngrN05LdU5ndkY1M2p0RzRIdDBjCnRrT2VhSndkaG9OK1Azbmx5SmU4cWpSNXJISFBiNEdUdjZ1VGp2WnpaUi9VNXpUeUFSMTRVUDNXelhBa2hwVFQKQUxUUklYQ0pPRjlNU2NoWXdRdjN5clkrSU9pOG5WZWNTTzFQWEtURlN0QUFoQitiNzFUeEdNbituOVUzNkw2YgpWb2kzdnhOTHpvRUttNlZvV2FhanFzUm4xTEdEU0RVcm80LzF2Y2Y4clc4NHlSSGREb2U3d1l3dWFUV3VYc1NICk54OCt1UnpucExCTTN3OFFmNTgvNkZlN1dVMVZDL0J6Z0RhZkMzT0hlS3p5eWUwRTFCaTVuU2N5aFV4VWxES1QKTnFvNE1BRUNnWUVBK2EzYlo2REtkUkdabmo0cWY4NVlCNmtzbzJCc293Z2orNHRTbVJEQkpoV2M1b1BqTk5wNQp6QS9iNGtjUGc4b1hNZlRzNkEvN1FDQk0rSytnRmk3R211akVPVmQrb2tLeTdDNnpmZnVPWHB6ZWVmS1hKM3JZClczbHRNQks2TEYrUDJQc3ZyYmtYb2RtTUNGditRcjlnOWhFQkFydWxRaVp6SVhSVWJ6aVM4TUVDZ1lFQTNzYXMKb3VkZmFvRTYrQk50YktqOGdLNENsbkZMaVoyMCtQNWFiRVFDOEdsRmlabjMxV2NGUHFzbGdEWXhTL3lGQ0dLUAphcFdiNDlZRjRMMnl0YXhmUlhneXc0VWlHNFJRSXlVVDhJSFRXQTkwdFFxb3dBc3NQeHBUR1hTMWRQTXNJQUlGCkFDLzU1ZDVQV1hReVJqTSt6MzVmUEZzOHZRQ0l1TUNuYU90eXMwVUNnWUVBK1VTR2VHWUIybkRRMGpnMFM5YWcKOGowR3NMRnlwQzFiWnlYSU44S1BZc3RQRXFCM2RHdnVEem1DQjkxejh0b080RFFyVk4rbnNuVE5BN2FxOTVxSgpjMXlSa3NIMFRtQ1NxdE5SSmFUQWxWcTlqamdRaWp6TnhqMXJNZ1J3VkI2dnlTdTFoUlgyTHdLM0dCMW5zaEhJCjVzRkJKZzVheGJrSFZrNENnZXVVWDhFQ2dZQXA2b0hUQ091NEUyYXdCSi9ESVN5WlhhUlpBQ294VTM0WWwyc1cKRWRubnVEY0FRL3NRcVJpZ2lQMCtXWFAvRXgxSXpacWtlRS9qbDRKMW5kdkJPUlNYOHB6Q2t3c3UyRDluelhNcAovcE53YjBBTFRGMGgvVGd2QzFuMVlUTS9OUDNwYTlmYkNDdmg1MmxRc0g5QkhDVkdUMFhHQ25pc0t5eU9icGxSCk1YUGNiUUtCZ1FEcXg0ODhyc2krT0Jlci81MHNWZE1lTWNsSzFEaVZER013VFR3ZmZBRFFlT1BaN00xaitaU04KRVhYMHpGZGN4Mk81TU1hWkFNY01DMHl6Nm9HV0lVODRWT3AxWjNoOGV5dS9Ec3F0Y1ZIUkxDSmcrWWlVZkR6QgpuKzFXeEtkTmVUc1h6L01JMi9QNlQyQ2NSUHRyT2JScTBDUzdidDgzVzlqZmdsRm5CeStwc0E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= kubernetes2 配置文件 ~/."><meta property="og:type" content="article"><meta property="og:url" content="https://iamwlb.github.io/kubernetes-example/"><meta property="og:image" content="https://iamwlb.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-20T13:23:05+08:00"><meta property="article:modified_time" content="2021-07-20T13:23:05+08:00"><meta property="og:site_name" content="DevPro Insights"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://iamwlb.github.io/logo.png"><meta name=twitter:title content="Kubernetes Example"><meta name=twitter:description content="添加cluster和context 环境说明 项 说明 kubernetes1 192.168.0.101 kubernetes2 192.168.0.102 mac-pro 笔者的笔记本电脑，用来添加Cluster和设置context 配置文件 kubernetes1 配置文件 ~/.kube/config 内容如下：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 apiVersion: v1 kind: Config clusters: - cluster: api-version: v1 certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URXpOVEUxTVZvWERUTXhNRGN4TXpFek5URTFNVm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1PcFJVRzFaZm5NClcwc1pHamtBZ0dJcTg0UDlwTzh6RGxnc2RHUWJtQ0FYNUN0d3Mza0VXZzJVYnlYZUhhNDhxV09NRTVpNHpsZHEKMDl2QXZkeitoWHVjOHE0c0xqRjhFdW5jaEJhd002T1YrY04wbHlEOE0xcEUwelRoenRhYnZUQllhVVNuZmovbgpjditrWUlDNUdQRDRMdjFTWXBYOTdSK2R2TzdGaVg0a0t1d1p4ZVVETHdmQmN4NVdXaEdIT0tBQ0lFdHU5bkRyCkJTbnV2dE9lQ0kwUktrdzQwQ2pnMjVlYzVsT01paW1lNmpFdW5IZ0VpSkhmM0FtaGpSa0tmNVdaS2UreEpweDEKYjhIUFAvUXVJVnZSQVViOFA2VThUdGlmbVFRc0ZOMFZVK3h1QmN1b250UXFGVXFxQSt3MUtGUDBMOGVseHFIQgpESGc4elhhYXJDOENBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRk9ucGtjVmR5cW9JdUplZGNVWE9KK0Y3R0ViRkNCcytlcVkKLzBaMUZqNjQxZTJqZC9MNU9LMVJYTXF6ZEhIUm5WaEtUeXJDcWhXR2RLc2VjMmRrU1VBanh1TC9vQ1B1NldDMApaYkFPQXNCMXZuZW5WUTN0Y2h6OWU3ZnZ2b0dRWUV4NnpsMEVlcHA2N09EYUZIbHhsUGxINnN1dXhRM0VUQW9NCmV5UStBbHF0N0pwT3dzNEZRM3BBY1BOc2ZzZ0ZGQkJ0cjlPbDBMQm1xZUpBazlUN01LdHZSYnE2dkRsMWVTdFQKc05jMkdNaXpxUjY1QnQxc1B6QjF1VjdFditLVElFd1g3Vm84Um15ZjMrQjkzanBicHgrVEk1dGxxUXN6ZExUdgpod3pDQnhvZDJpcE9wdjU1Sm9ycmNsZ0RuOHFobTlYWVJXTk4vM2IzdGd2R1MvK1lKK1E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K server: &#34;https://192.168.0.101:6443&#34; name: &#34;local&#34; contexts: - context: cluster: &#34;local&#34; user: &#34;kube-admin-local&#34; name: &#34;local&#34; current-context: &#34;local&#34; users: - name: &#34;kube-admin-local&#34; user: client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJQ2RkVkJSRG9IM2t3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE16VXhOVEZhRncwek1UQTNNVE14TkRFM016VmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTJVYUpHMEN0VmhhS0hSeExURnFwbjlNaUcrUG8KdlZ6UGxZcXg0MXBCNk1DMmc1cHJ1MjBvdEwxWmxITkRFL01PQzNNNTVibjR0RDFzZUF5MjQ1ZEEzQUV6cml0UgovUEhNRzF3Ky9ZTTZiOTFQajd3cUd5UUE1dUNPTE1WbUYxQm5JbTRrSlNQUlNvRDFsZHMzcWFZeGl5VlpOT1VDClpXckR6NDh4Ry8wcG5PNDZNRGFNZ0VWS2VDU0ZhNm0zYjFaR1FWcEpqVi9HdVQ2QzhwOExucVBST0QzbkF3OXkKa1JnVm92MnlodGFwZXR6aDdVV2tTWHM3Vk5Gei9hM3pMT3FjQUdJa0plLzNXQ29iMTBPVG5Rbmg1Mms4SmphSgpzUm9JN2RLMURXMS9nT3crZDNKK2RkU0hYQTlreXF6UkZlWXJzaitRQTJHcFdab3RXbEJoWHVQWEJRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFMejNNOWRxNzJvSENkSW16ODIzMXNuY0N6ZVI2QlFFQUhWOVlzR3RqSnl0Nm54UAo2bW1ORVE2eCtpSjhSenRHanVwb2Z2aGtwdS91VGZ0MUtYbm1yaHg5N1FQbWtqaXZSVnVoMGxjVE01aWVldXZSCmxONklqbzgwUVBuR2c5Q0tMWndONHZmTnBPbUg3a2J4VzJDOWJWVmRyb1VjQmZ3QmJ1ejFtQjNnVVVYYlovMlAKL3lsRStpTW5OQ0xseGtFYXMrZnpoL0VmTzVLRE8wY0xFMDJIaEV2WEI1WkFEZUViZzlRdHFMNkZwOW9pVTRYbgpXcTR5Z1llV2NLWndyZ0hWWXpaOXQ5RkdlQUNnM0FLWHdwcDhDN3lDSE1EUWpmcnBsQzI5QU1WN2RHWjZ4azI0CmxSU3JiRVA4NVF1M0tUOUZyS0NaY3E1OWd2bm0xUEREVHJLaVI4VT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMlVhSkcwQ3RWaGFLSFJ4TFRGcXBuOU1pRytQb3ZWelBsWXF4NDFwQjZNQzJnNXByCnUyMG90TDFabEhOREUvTU9DM001NWJuNHREMXNlQXkyNDVkQTNBRXpyaXRSL1BITUcxdysvWU02YjkxUGo3d3EKR3lRQTV1Q09MTVZtRjFCbkltNGtKU1BSU29EMWxkczNxYVl4aXlWWk5PVUNaV3JEejQ4eEcvMHBuTzQ2TURhTQpnRVZLZUNTRmE2bTNiMVpHUVZwSmpWL0d1VDZDOHA4TG5xUFJPRDNuQXc5eWtSZ1ZvdjJ5aHRhcGV0emg3VVdrClNYczdWTkZ6L2EzekxPcWNBR0lrSmUvM1dDb2IxME9UblFuaDUyazhKamFKc1JvSTdkSzFEVzEvZ093K2QzSisKZGRTSFhBOWt5cXpSRmVZcnNqK1FBMkdwV1pvdFdsQmhYdVBYQlFJREFRQUJBb0lCQUVXbDVxMWx2aXFxYnZ1Rgo1bDFEY3J4WTRjWXUrSnc2OUEvcnRibzdaSVZId1RuT2RscE9VNDRjWkdyQngrN05LdU5ndkY1M2p0RzRIdDBjCnRrT2VhSndkaG9OK1Azbmx5SmU4cWpSNXJISFBiNEdUdjZ1VGp2WnpaUi9VNXpUeUFSMTRVUDNXelhBa2hwVFQKQUxUUklYQ0pPRjlNU2NoWXdRdjN5clkrSU9pOG5WZWNTTzFQWEtURlN0QUFoQitiNzFUeEdNbituOVUzNkw2YgpWb2kzdnhOTHpvRUttNlZvV2FhanFzUm4xTEdEU0RVcm80LzF2Y2Y4clc4NHlSSGREb2U3d1l3dWFUV3VYc1NICk54OCt1UnpucExCTTN3OFFmNTgvNkZlN1dVMVZDL0J6Z0RhZkMzT0hlS3p5eWUwRTFCaTVuU2N5aFV4VWxES1QKTnFvNE1BRUNnWUVBK2EzYlo2REtkUkdabmo0cWY4NVlCNmtzbzJCc293Z2orNHRTbVJEQkpoV2M1b1BqTk5wNQp6QS9iNGtjUGc4b1hNZlRzNkEvN1FDQk0rSytnRmk3R211akVPVmQrb2tLeTdDNnpmZnVPWHB6ZWVmS1hKM3JZClczbHRNQks2TEYrUDJQc3ZyYmtYb2RtTUNGditRcjlnOWhFQkFydWxRaVp6SVhSVWJ6aVM4TUVDZ1lFQTNzYXMKb3VkZmFvRTYrQk50YktqOGdLNENsbkZMaVoyMCtQNWFiRVFDOEdsRmlabjMxV2NGUHFzbGdEWXhTL3lGQ0dLUAphcFdiNDlZRjRMMnl0YXhmUlhneXc0VWlHNFJRSXlVVDhJSFRXQTkwdFFxb3dBc3NQeHBUR1hTMWRQTXNJQUlGCkFDLzU1ZDVQV1hReVJqTSt6MzVmUEZzOHZRQ0l1TUNuYU90eXMwVUNnWUVBK1VTR2VHWUIybkRRMGpnMFM5YWcKOGowR3NMRnlwQzFiWnlYSU44S1BZc3RQRXFCM2RHdnVEem1DQjkxejh0b080RFFyVk4rbnNuVE5BN2FxOTVxSgpjMXlSa3NIMFRtQ1NxdE5SSmFUQWxWcTlqamdRaWp6TnhqMXJNZ1J3VkI2dnlTdTFoUlgyTHdLM0dCMW5zaEhJCjVzRkJKZzVheGJrSFZrNENnZXVVWDhFQ2dZQXA2b0hUQ091NEUyYXdCSi9ESVN5WlhhUlpBQ294VTM0WWwyc1cKRWRubnVEY0FRL3NRcVJpZ2lQMCtXWFAvRXgxSXpacWtlRS9qbDRKMW5kdkJPUlNYOHB6Q2t3c3UyRDluelhNcAovcE53YjBBTFRGMGgvVGd2QzFuMVlUTS9OUDNwYTlmYkNDdmg1MmxRc0g5QkhDVkdUMFhHQ25pc0t5eU9icGxSCk1YUGNiUUtCZ1FEcXg0ODhyc2krT0Jlci81MHNWZE1lTWNsSzFEaVZER013VFR3ZmZBRFFlT1BaN00xaitaU04KRVhYMHpGZGN4Mk81TU1hWkFNY01DMHl6Nm9HV0lVODRWT3AxWjNoOGV5dS9Ec3F0Y1ZIUkxDSmcrWWlVZkR6QgpuKzFXeEtkTmVUc1h6L01JMi9QNlQyQ2NSUHRyT2JScTBDUzdidDgzVzlqZmdsRm5CeStwc0E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= kubernetes2 配置文件 ~/."><meta name=application-name content="DevPro Insights"><meta name=apple-mobile-web-app-title content="DevPro Insights"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://iamwlb.github.io/kubernetes-example/><link rel=next href=https://iamwlb.github.io/first_post/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kubernetes Example","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/iamwlb.github.io\/kubernetes-example\/"},"image":[{"@type":"ImageObject","url":"https:\/\/iamwlb.github.io\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"posts","keywords":"Kubernetes","wordcount":7208,"url":"https:\/\/iamwlb.github.io\/kubernetes-example\/","datePublished":"2021-07-20T13:23:05+08:00","dateModified":"2021-07-20T13:23:05+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/iamwlb.github.io\/images\/avatar.png","width":528,"height":560}},"author":{"@type":"Person","name":"Libing Wang"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="DevPro Insights"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>DevPro Insights</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/categories/documentation/>Docs </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="DevPro Insights"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>DevPro Insights</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/categories/documentation/ title>Docs</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Kubernetes Example</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://iamwlb.github.io title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Libing Wang</a></span>&nbsp;<span class=post-category>included in <a href=/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/><i class="far fa-folder fa-fw" aria-hidden=true></i>云原生</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-07-20>2021-07-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;7208 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;34 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#添加cluster和context>添加cluster和context</a><ul><li><a href=#环境说明>环境说明</a></li><li><a href=#配置文件>配置文件</a><ul><li><a href=#kubernetes1-配置文件>kubernetes1 配置文件</a></li><li><a href=#kubernetes2-配置文件>kubernetes2 配置文件</a></li></ul></li><li><a href=#add-cluster-and-context>Add cluster and context</a></li><li><a href=#演示设置-context>演示：设置 context</a></li></ul></li><li><a href=#namespace>namespace</a><ul><li><a href=#定义-namespace>定义 namespace</a></li><li><a href=#演示创建-namespace>演示：创建 namespace</a></li></ul></li><li><a href=#pod>Pod</a><ul><li><a href=#定义-pod>定义 pod</a></li><li><a href=#演示创建-pod>演示：创建 pod</a></li></ul></li><li><a href=#deployment>deployment</a><ul><li><a href=#41-nginx_deploymdnetyml>4.1 nginx_deploymdnet.yml</a></li><li><a href=#42-nginx_deployment_updateyml>4.2 nginx_deployment_update.yml</a></li><li><a href=#43-nginx_deployment_scaleyml>4.3 nginx_deployment_scale.yml</a></li><li><a href=#演示创建-deployment>演示：创建 deployment</a></li></ul></li><li><a href=#service>Service</a><ul><li><a href=#service-介绍>Service 介绍</a></li><li><a href=#service-类型>Service 类型</a></li><li><a href=#501-podyaml>5.0.1 pod.yaml</a></li><li><a href=#502-busyboxyaml>5.0.2 busybox.yaml</a></li><li><a href=#51-clusteripyaml>5.1 ClusterIP.yaml</a></li><li><a href=#52-nodeportyaml>5.2 NodePort.yaml</a></li><li><a href=#演示service>演示：Service</a><ul><li><a href=#演示创建-clusterip-类型的-service>演示：创建 ClusterIP 类型的 Service</a></li><li><a href=#演示创建-nodeport-类型的-service>演示：创建 NodePort 类型的 Service</a></li><li><a href=#演示创建-loadbalancer-类型的-service>演示：创建 LoadBalancer 类型的 Service</a></li></ul></li><li><a href=#演示service-auto-discovery>演示：Service Auto Discovery</a><ul><li><a href=#演示检查-k8s-环境是否支持-service-autodiscovery>演示：检查 k8s 环境是否支持 Service AutoDiscovery</a></li><li><a href=#演示基于-dns-实现-service-auto-discovery>演示：基于 DNS 实现 Service Auto Discovery</a></li><li><a href=#演示基于-环境变量-实现-service-auto-discovery>演示：基于 环境变量 实现 Service Auto Discovery</a></li></ul></li></ul></li><li><a href=#health-check>Health Check</a><ul><li><a href=#health-check-介绍>Health Check 介绍</a></li><li><a href=#探针支持的类型>探针支持的类型</a></li><li><a href=#http-方式探针示例>HTTP 方式探针示例</a></li><li><a href=#command-方式探针示例>Command 方式探针示例</a></li><li><a href=#tcp-方式探针示例>TCP 方式探针示例</a></li><li><a href=#health-check-中两种探针的对比>Health Check 中两种探针的对比</a></li><li><a href=#liveness-probe-配置示例>Liveness Probe 配置示例</a></li><li><a href=#readness-probe-配置示例>readness probe 配置示例</a></li></ul></li><li><a href=#ingress>Ingress</a><ul><li><a href=#ingress-resource>Ingress Resource</a><ul><li><a href=#name-based-routing>Name based routing</a></li><li><a href=#path-based-routing>Path based routing</a></li></ul></li><li><a href=#ingress-controller>Ingress Controller</a></li></ul></li><li><a href=#volumes>Volumes</a><ul><li><a href=#hostpath>hostPath</a><ul><li><a href=#定义-hostpath>定义 hostPath</a></li><li><a href=#演示创建-hostpath>演示：创建 hostPath</a></li></ul></li><li><a href=#pvc--pv>PVC & PV</a><ul><li><a href=#821-pvcyaml>8.2.1 pvc.yaml</a></li><li><a href=#822-pvc-mysqlyaml>8.2.2 pvc-mysql.yaml</a></li><li><a href=#823-mysqlyaml>8.2.3 mysql.yaml</a></li><li><a href=#演示创建pvc--pv>演示：创建pvc & pv</a></li><li><a href=#演示mysql使用pvc>演示：mysql使用pvc</a></li></ul></li><li><a href=#secret>Secret</a><ul><li><a href=#overview>overview</a></li><li><a href=#命令行创建-secret-语法>命令行创建 Secret 语法</a></li><li><a href=#演示使用-secret>演示：使用 secret</a></li></ul></li><li><a href=#configmap>ConfigMap</a><ul><li><a href=#configmap-语法>configmap 语法</a></li><li><a href=#演示创建-configmap>演示：创建 configmap</a></li><li><a href=#演示使用-configmap>演示：使用 configmap</a></li></ul></li></ul></li><li><a href=#debug>Debug</a><ul><li><a href=#pod-一直是-containercreating-状态>pod 一直是 ContainerCreating 状态</a></li><li><a href=#pvc一直是pending状态>pvc一直是pending状态</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=添加cluster和context>添加cluster和context</h2><h3 id=环境说明>环境说明</h3><table><thead><tr><th>项</th><th>说明</th></tr></thead><tbody><tr><td>kubernetes1</td><td>192.168.0.101</td></tr><tr><td>kubernetes2</td><td>192.168.0.102</td></tr><tr><td>mac-pro</td><td>笔者的笔记本电脑，用来添加Cluster和设置context</td></tr></tbody></table><h3 id=配置文件>配置文件</h3><h4 id=kubernetes1-配置文件>kubernetes1 配置文件</h4><p>~/.kube/config 内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>api-version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URXpOVEUxTVZvWERUTXhNRGN4TXpFek5URTFNVm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1PcFJVRzFaZm5NClcwc1pHamtBZ0dJcTg0UDlwTzh6RGxnc2RHUWJtQ0FYNUN0d3Mza0VXZzJVYnlYZUhhNDhxV09NRTVpNHpsZHEKMDl2QXZkeitoWHVjOHE0c0xqRjhFdW5jaEJhd002T1YrY04wbHlEOE0xcEUwelRoenRhYnZUQllhVVNuZmovbgpjditrWUlDNUdQRDRMdjFTWXBYOTdSK2R2TzdGaVg0a0t1d1p4ZVVETHdmQmN4NVdXaEdIT0tBQ0lFdHU5bkRyCkJTbnV2dE9lQ0kwUktrdzQwQ2pnMjVlYzVsT01paW1lNmpFdW5IZ0VpSkhmM0FtaGpSa0tmNVdaS2UreEpweDEKYjhIUFAvUXVJVnZSQVViOFA2VThUdGlmbVFRc0ZOMFZVK3h1QmN1b250UXFGVXFxQSt3MUtGUDBMOGVseHFIQgpESGc4elhhYXJDOENBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRk9ucGtjVmR5cW9JdUplZGNVWE9KK0Y3R0ViRkNCcytlcVkKLzBaMUZqNjQxZTJqZC9MNU9LMVJYTXF6ZEhIUm5WaEtUeXJDcWhXR2RLc2VjMmRrU1VBanh1TC9vQ1B1NldDMApaYkFPQXNCMXZuZW5WUTN0Y2h6OWU3ZnZ2b0dRWUV4NnpsMEVlcHA2N09EYUZIbHhsUGxINnN1dXhRM0VUQW9NCmV5UStBbHF0N0pwT3dzNEZRM3BBY1BOc2ZzZ0ZGQkJ0cjlPbDBMQm1xZUpBazlUN01LdHZSYnE2dkRsMWVTdFQKc05jMkdNaXpxUjY1QnQxc1B6QjF1VjdFditLVElFd1g3Vm84Um15ZjMrQjkzanBicHgrVEk1dGxxUXN6ZExUdgpod3pDQnhvZDJpcE9wdjU1Sm9ycmNsZ0RuOHFobTlYWVJXTk4vM2IzdGd2R1MvK1lKK1E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://192.168.0.101:6443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kube-admin-local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kube-admin-local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJQ2RkVkJSRG9IM2t3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE16VXhOVEZhRncwek1UQTNNVE14TkRFM016VmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTJVYUpHMEN0VmhhS0hSeExURnFwbjlNaUcrUG8KdlZ6UGxZcXg0MXBCNk1DMmc1cHJ1MjBvdEwxWmxITkRFL01PQzNNNTVibjR0RDFzZUF5MjQ1ZEEzQUV6cml0UgovUEhNRzF3Ky9ZTTZiOTFQajd3cUd5UUE1dUNPTE1WbUYxQm5JbTRrSlNQUlNvRDFsZHMzcWFZeGl5VlpOT1VDClpXckR6NDh4Ry8wcG5PNDZNRGFNZ0VWS2VDU0ZhNm0zYjFaR1FWcEpqVi9HdVQ2QzhwOExucVBST0QzbkF3OXkKa1JnVm92MnlodGFwZXR6aDdVV2tTWHM3Vk5Gei9hM3pMT3FjQUdJa0plLzNXQ29iMTBPVG5Rbmg1Mms4SmphSgpzUm9JN2RLMURXMS9nT3crZDNKK2RkU0hYQTlreXF6UkZlWXJzaitRQTJHcFdab3RXbEJoWHVQWEJRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFMejNNOWRxNzJvSENkSW16ODIzMXNuY0N6ZVI2QlFFQUhWOVlzR3RqSnl0Nm54UAo2bW1ORVE2eCtpSjhSenRHanVwb2Z2aGtwdS91VGZ0MUtYbm1yaHg5N1FQbWtqaXZSVnVoMGxjVE01aWVldXZSCmxONklqbzgwUVBuR2c5Q0tMWndONHZmTnBPbUg3a2J4VzJDOWJWVmRyb1VjQmZ3QmJ1ejFtQjNnVVVYYlovMlAKL3lsRStpTW5OQ0xseGtFYXMrZnpoL0VmTzVLRE8wY0xFMDJIaEV2WEI1WkFEZUViZzlRdHFMNkZwOW9pVTRYbgpXcTR5Z1llV2NLWndyZ0hWWXpaOXQ5RkdlQUNnM0FLWHdwcDhDN3lDSE1EUWpmcnBsQzI5QU1WN2RHWjZ4azI0CmxSU3JiRVA4NVF1M0tUOUZyS0NaY3E1OWd2bm0xUEREVHJLaVI4VT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMlVhSkcwQ3RWaGFLSFJ4TFRGcXBuOU1pRytQb3ZWelBsWXF4NDFwQjZNQzJnNXByCnUyMG90TDFabEhOREUvTU9DM001NWJuNHREMXNlQXkyNDVkQTNBRXpyaXRSL1BITUcxdysvWU02YjkxUGo3d3EKR3lRQTV1Q09MTVZtRjFCbkltNGtKU1BSU29EMWxkczNxYVl4aXlWWk5PVUNaV3JEejQ4eEcvMHBuTzQ2TURhTQpnRVZLZUNTRmE2bTNiMVpHUVZwSmpWL0d1VDZDOHA4TG5xUFJPRDNuQXc5eWtSZ1ZvdjJ5aHRhcGV0emg3VVdrClNYczdWTkZ6L2EzekxPcWNBR0lrSmUvM1dDb2IxME9UblFuaDUyazhKamFKc1JvSTdkSzFEVzEvZ093K2QzSisKZGRTSFhBOWt5cXpSRmVZcnNqK1FBMkdwV1pvdFdsQmhYdVBYQlFJREFRQUJBb0lCQUVXbDVxMWx2aXFxYnZ1Rgo1bDFEY3J4WTRjWXUrSnc2OUEvcnRibzdaSVZId1RuT2RscE9VNDRjWkdyQngrN05LdU5ndkY1M2p0RzRIdDBjCnRrT2VhSndkaG9OK1Azbmx5SmU4cWpSNXJISFBiNEdUdjZ1VGp2WnpaUi9VNXpUeUFSMTRVUDNXelhBa2hwVFQKQUxUUklYQ0pPRjlNU2NoWXdRdjN5clkrSU9pOG5WZWNTTzFQWEtURlN0QUFoQitiNzFUeEdNbituOVUzNkw2YgpWb2kzdnhOTHpvRUttNlZvV2FhanFzUm4xTEdEU0RVcm80LzF2Y2Y4clc4NHlSSGREb2U3d1l3dWFUV3VYc1NICk54OCt1UnpucExCTTN3OFFmNTgvNkZlN1dVMVZDL0J6Z0RhZkMzT0hlS3p5eWUwRTFCaTVuU2N5aFV4VWxES1QKTnFvNE1BRUNnWUVBK2EzYlo2REtkUkdabmo0cWY4NVlCNmtzbzJCc293Z2orNHRTbVJEQkpoV2M1b1BqTk5wNQp6QS9iNGtjUGc4b1hNZlRzNkEvN1FDQk0rSytnRmk3R211akVPVmQrb2tLeTdDNnpmZnVPWHB6ZWVmS1hKM3JZClczbHRNQks2TEYrUDJQc3ZyYmtYb2RtTUNGditRcjlnOWhFQkFydWxRaVp6SVhSVWJ6aVM4TUVDZ1lFQTNzYXMKb3VkZmFvRTYrQk50YktqOGdLNENsbkZMaVoyMCtQNWFiRVFDOEdsRmlabjMxV2NGUHFzbGdEWXhTL3lGQ0dLUAphcFdiNDlZRjRMMnl0YXhmUlhneXc0VWlHNFJRSXlVVDhJSFRXQTkwdFFxb3dBc3NQeHBUR1hTMWRQTXNJQUlGCkFDLzU1ZDVQV1hReVJqTSt6MzVmUEZzOHZRQ0l1TUNuYU90eXMwVUNnWUVBK1VTR2VHWUIybkRRMGpnMFM5YWcKOGowR3NMRnlwQzFiWnlYSU44S1BZc3RQRXFCM2RHdnVEem1DQjkxejh0b080RFFyVk4rbnNuVE5BN2FxOTVxSgpjMXlSa3NIMFRtQ1NxdE5SSmFUQWxWcTlqamdRaWp6TnhqMXJNZ1J3VkI2dnlTdTFoUlgyTHdLM0dCMW5zaEhJCjVzRkJKZzVheGJrSFZrNENnZXVVWDhFQ2dZQXA2b0hUQ091NEUyYXdCSi9ESVN5WlhhUlpBQ294VTM0WWwyc1cKRWRubnVEY0FRL3NRcVJpZ2lQMCtXWFAvRXgxSXpacWtlRS9qbDRKMW5kdkJPUlNYOHB6Q2t3c3UyRDluelhNcAovcE53YjBBTFRGMGgvVGd2QzFuMVlUTS9OUDNwYTlmYkNDdmg1MmxRc0g5QkhDVkdUMFhHQ25pc0t5eU9icGxSCk1YUGNiUUtCZ1FEcXg0ODhyc2krT0Jlci81MHNWZE1lTWNsSzFEaVZER013VFR3ZmZBRFFlT1BaN00xaitaU04KRVhYMHpGZGN4Mk81TU1hWkFNY01DMHl6Nm9HV0lVODRWT3AxWjNoOGV5dS9Ec3F0Y1ZIUkxDSmcrWWlVZkR6QgpuKzFXeEtkTmVUc1h6L01JMi9QNlQyQ2NSUHRyT2JScTBDUzdidDgzVzlqZmdsRm5CeStwc0E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=kubernetes2-配置文件>kubernetes2 配置文件</h4><p>~/.kube/config 内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>api-version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URTFNVGd5T0ZvWERUTXhNRGN4TXpFMU1UZ3lPRm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUs1WjdRSUNpM3dLCkhsbUZvYXJ1SVdqK2VwVnpkUjRtN2VsQnk3dGUxMWt0TzZ6VDRpbGZaODV3RDRlYzRSZmJGVDVwaDNJbDFCQkcKNnRhTXpSWEVoRFhGdHN5eWZhbEVOcVRETlV0SC8zaFZKZjZxbnk2SE1YV0hzdWlkZ3d1MXlYZG9Ka3dDbjVEbwowUjN1dEowTVBvenZoSzhOeHZJRk1xUjN4NjF0Y2RGUjF3RFVTeGlxeDdoQWtLQjBqUkkzSEJyR05QcDlwTTBtCjlnK1RWQm1WOUl2TkR0VUprNG5YWEVkbS9BOVJzQmNUWjVDVC9SbjQxN0NhbkwzdTJpTlU0UHVCUjZUMDB1bFAKbFRSRERwQ3Y1d1N0TWxLV3EzeHRiWE5Xa2JmU3dTUiswZ2M3WDR2WGVWS2hwdmNLL3FwbEtuSU1KcVZoc1ZINApHdTExTldBM05IRUNBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRWVHWUR2djM0bXZxNDRFUXRFdlBhM1V5V05iL0paOTUzWncKd1dId2d0S2dBd3RvbG5xdG9iMUJzdktBVE00VUEwbWNjVThpL0tmTFMvNVZxaC9vK0NGNjhnMmtEendnS2U3aApydWxOOTE2RWIwOS82M2NHYlhCV0xuT0JxNmRlT3NhcVN4dzNkYmtWN1pGQy9GS3IvOWNOYndmMXhRa1NvRDlXCjRtVnJPNzRMQlRHQk9OMFhxanllVmYwbnBMTlZZUzVsZEU1UHhaM21QZk5oOWptcWpVcjBJZ2ViZHJVZm54QU8KaHZEOHJGbE1QTUlaWEdkTjlZUHBxb2srVTY0SnA1NHhkNWNiYk5XaXdYYXRJYjV4dnoremZ5VFluYXJlUmtoKwpFd3Rtd3VZMitra1pkelpTdTFKSXBua0ZNTUhQRzI0b2k5RzBvekpsUDIwcE5iMFVHWUU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://192.168.0.102:6443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kube-admin-local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kube-admin-local&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJSjlXZmJjSVpYaWN3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE5URTRNamhhRncwek1UQTNNVE14TlRNd01ERmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXgzdElldjl4dHpoTVlmVG4zaFJBbXBnRys1RnMKOHlOUnQrK2IzMUpsM3R3KzkyaGdmeGwyTWc0cktVeWFyUkNkTGdwV0FiaHUyeDJTZUdTY0tWdGFoYVgyZ0xGMwpsVlVTVkhyWEZYQ2RSU1N4bnQ1eXQ0QUpwVlRMbGNPVVZtREtscEtvQi9VT1YrbGVKOFRydnJGWEU2ZWdBTzc1CnRKSkYxZURtbEVRR1F2WmxkRHM0RnNmeCtKelhhRXNpSTdySVM1MjJuUkdaa1dPaGZQU2lXYUVxRldlQU93MjIKMm5tNGVOS0VsMWtmNjlGL1pieHVVSDM3UDZmUEpQOG93QW44MG9EZFZOZm8yUWJTK29hZVMxK2hQNVJ2ZnErawozbDVlMGcrZ2c2ZnhxaWtrQXAySlNuRlJyYTNUdnRtRnBaeGo2NThDdE1xKzB0M3VqbDRNQk1CQ1JRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFENUpkM3NMYmpORGZ5Z0kxclNnNWRZU2FHNmJ2NDN0OUdhbHR0MDhBZGZYVjNVcgpHY0lYaEZBTkwwMFZ2VmxLdDlXbCtYcWRxWnNRYWhmZTNISk85WHV4RDVscGczUEQ5T01SVGUvWGM4NDYxbTBWCkpDMjMyODYzaFRyaFZrUnByakJDb3hwVDZTOWVkM2kvWEFERVptWDJWTkhIUSt2TmJZeXVlc2ZRSWxpbFJ3R24KbStmK01VMmN0UGlvek1UbFBWaWthL3FvTWd3V09RMEFockhJc2dOMnJiTmQrRFh2YVVIMytjY292UGN5b0dlNApVNlJta2FJMEZ4cG5PN3d1bzIyaEFOeVpHU2t6eE11WkVQMVBGbERpdFY3aWNNYWZTekR4MUdTampRQXNvekR1CmREWFVwVUFPeHNFc1QzdkZtR3ZBNHhpTXBScHNDK3NCNWdqNkJwZz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeDN0SWV2OXh0emhNWWZUbjNoUkFtcGdHKzVGczh5TlJ0KytiMzFKbDN0dys5MmhnCmZ4bDJNZzRyS1V5YXJSQ2RMZ3BXQWJodTJ4MlNlR1NjS1Z0YWhhWDJnTEYzbFZVU1ZIclhGWENkUlNTeG50NXkKdDRBSnBWVExsY09VVm1ES2xwS29CL1VPVitsZUo4VHJ2ckZYRTZlZ0FPNzV0SkpGMWVEbWxFUUdRdlpsZERzNApGc2Z4K0p6WGFFc2lJN3JJUzUyMm5SR1prV09oZlBTaVdhRXFGV2VBT3cyMjJubTRlTktFbDFrZjY5Ri9aYnh1ClVIMzdQNmZQSlA4b3dBbjgwb0RkVk5mbzJRYlMrb2FlUzEraFA1UnZmcStrM2w1ZTBnK2dnNmZ4cWlra0FwMkoKU25GUnJhM1R2dG1GcFp4ajY1OEN0TXErMHQzdWpsNE1CTUJDUlFJREFRQUJBb0lCQUJnT0h0UnVQMmxIeWJZNgpVVWV2aTRiWTlHYWJ4OWFlR0xta2xGaGUyRmdDbVRrK2hmeHR0cG9jcVVuR3FoUmFuNG13eDJSWHVFNkdCMmFyClEwV2RkWklPVEdhQ2dCZ3E5UlhvNWt6NGtvNkcrVUJlTk5rNkFHL0doUEpmYm1Eb05TWHBNNGdhSGd1dDRhUE0KRkYyZmh3K2d0Q1BJcmFYL3lab2NEOUlyVGRIL0s3Z0R4cHFkR2M3YUtmUXBvWHdjbWRFZGowL2JFMUhGZDlSUwpnZlpGcFp2RVNDcTlaQnluZVVWUHlTZVR5SlI0bWEzZEwzalJiWmZQTzlFcVNRbSsxbWZzYXhRU3k3K1JKKzY4Cmd2dGZCVVNGQ1l4N0JHemxiT1RHcHJ1em0vdGJXWHBrTCtxR1EwL3FHSllFd2dicFZ5YVo3WXV6N2RHT1VhdjcKSldBdzd4VUNnWUVBeTBkalV2NGliTGt4YjFlZkl0bE9uazZ3NFNlYzdtT1NNd3Y3c1dzSkpja0RkekRwMjMxNgpqRUg4dEEvTmswOEtRNS8vVDVFVGNmVnRqSWJhWmxRcDI0ZXAxOGdJUFJkN1RWbVgyN25FbkxBejJabzFMNUtwCmY0a0JOQUI3Y0J4M1JWYS81cHBJT0J0RDR6ekpwS1VQTFVFdGVUZ2VyOVVVTHVabkdQaWJCdWNDZ1lFQSt6ZkcKckorQjE2Z01rUmlmSGNmWU1qbVZwcXVTVFdncUVpaytjbUZ3VnVzL21IbGIxaDA2bFY0NUZWSG5tcm8zcWZVaQpQVXRDU29tWDYzZmlhWmwweG9rYXdVQUxZR1lTS1pxeTZFY2FJNEtTZ0NQaWtsS0wxbDd2cXFtbE5qV0N6dmdoCkVUaTQvbXZKMXBjUzQ5UytwSk9LRGJucFZDcWx5UXBRb2liY0EvTUNnWUFUcmppdWkwNDM2b0lmdm9MNHM4TkoKem1LUG1lODJvVXRCUi9LNVRaeVlIT3NKK2lGYUQ3N3luMXpnN2ZyQVBWSElGRkI2bXBnZ1cxdWMxRjJHdExWTQp2TWl6ekhrSHVTTkY3TnVuK1VkUXlEcHM0ZUl1VmV1MUhrV1FqRTluSGtwcDJ5ay9JVWJHcjlVVnhnZmJ1ZU5MClJWa3F1RVU0VHMvaWJvb2l2OGI2bHdLQmdRRGJHbWR1RVdSR2Vld1Q5Sng2ZGQxSzJNeDc1RElpenhHNmF6eHEKdUM4cHI5MzBsd3dRNzhjemxVMUdHZnhkQjhNYXVaRVdVbmhMMkR1bkJCVjFzb0NWMCtpQTJlSFNQdFBpYzJsTQppdzd5SDZTMG5CZTFOTWQvdmFkY2VyOThTeWwrYUEwM0h2akI5YkxCTlZ3bFYxeTYzMjlOejNNQWxIMnBuUlI4CmlGWG1Id0tCZ1FERFQycnU1RHRZU21PWTdzSzVwSFBvNVRja3B5K0hCWXJCRjVHaFQ2b2RWSHRhZW5KMG9mWS8KMHd0SkQ3VWlrU21zcmM0Y0h4ODQraXdvd0NyQVhXV2hDVDhQc2k5SHAwRUhVNWtSd3VPUWM0Z1RhQ3hvYytuOQp4UkJxMlFmS0NGeXhSQkZjY1ZaU3FDdENoWlQvaUMvZFBQMUJFNGR3RXdPYnBxdkxnRHJtVHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=add-cluster-and-context>Add cluster and context</h3><p>mac-pro 配置文 ~/.kube/config 内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URXpOVEUxTVZvWERUTXhNRGN4TXpFek5URTFNVm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1PcFJVRzFaZm5NClcwc1pHamtBZ0dJcTg0UDlwTzh6RGxnc2RHUWJtQ0FYNUN0d3Mza0VXZzJVYnlYZUhhNDhxV09NRTVpNHpsZHEKMDl2QXZkeitoWHVjOHE0c0xqRjhFdW5jaEJhd002T1YrY04wbHlEOE0xcEUwelRoenRhYnZUQllhVVNuZmovbgpjditrWUlDNUdQRDRMdjFTWXBYOTdSK2R2TzdGaVg0a0t1d1p4ZVVETHdmQmN4NVdXaEdIT0tBQ0lFdHU5bkRyCkJTbnV2dE9lQ0kwUktrdzQwQ2pnMjVlYzVsT01paW1lNmpFdW5IZ0VpSkhmM0FtaGpSa0tmNVdaS2UreEpweDEKYjhIUFAvUXVJVnZSQVViOFA2VThUdGlmbVFRc0ZOMFZVK3h1QmN1b250UXFGVXFxQSt3MUtGUDBMOGVseHFIQgpESGc4elhhYXJDOENBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRk9ucGtjVmR5cW9JdUplZGNVWE9KK0Y3R0ViRkNCcytlcVkKLzBaMUZqNjQxZTJqZC9MNU9LMVJYTXF6ZEhIUm5WaEtUeXJDcWhXR2RLc2VjMmRrU1VBanh1TC9vQ1B1NldDMApaYkFPQXNCMXZuZW5WUTN0Y2h6OWU3ZnZ2b0dRWUV4NnpsMEVlcHA2N09EYUZIbHhsUGxINnN1dXhRM0VUQW9NCmV5UStBbHF0N0pwT3dzNEZRM3BBY1BOc2ZzZ0ZGQkJ0cjlPbDBMQm1xZUpBazlUN01LdHZSYnE2dkRsMWVTdFQKc05jMkdNaXpxUjY1QnQxc1B6QjF1VjdFditLVElFd1g3Vm84Um15ZjMrQjkzanBicHgrVEk1dGxxUXN6ZExUdgpod3pDQnhvZDJpcE9wdjU1Sm9ycmNsZ0RuOHFobTlYWVJXTk4vM2IzdGd2R1MvK1lKK1E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://192.168.0.101:6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl4TURjeE5URTFNVGd5T0ZvWERUTXhNRGN4TXpFMU1UZ3lPRm93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUs1WjdRSUNpM3dLCkhsbUZvYXJ1SVdqK2VwVnpkUjRtN2VsQnk3dGUxMWt0TzZ6VDRpbGZaODV3RDRlYzRSZmJGVDVwaDNJbDFCQkcKNnRhTXpSWEVoRFhGdHN5eWZhbEVOcVRETlV0SC8zaFZKZjZxbnk2SE1YV0hzdWlkZ3d1MXlYZG9Ka3dDbjVEbwowUjN1dEowTVBvenZoSzhOeHZJRk1xUjN4NjF0Y2RGUjF3RFVTeGlxeDdoQWtLQjBqUkkzSEJyR05QcDlwTTBtCjlnK1RWQm1WOUl2TkR0VUprNG5YWEVkbS9BOVJzQmNUWjVDVC9SbjQxN0NhbkwzdTJpTlU0UHVCUjZUMDB1bFAKbFRSRERwQ3Y1d1N0TWxLV3EzeHRiWE5Xa2JmU3dTUiswZ2M3WDR2WGVWS2hwdmNLL3FwbEtuSU1KcVZoc1ZINApHdTExTldBM05IRUNBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRWVHWUR2djM0bXZxNDRFUXRFdlBhM1V5V05iL0paOTUzWncKd1dId2d0S2dBd3RvbG5xdG9iMUJzdktBVE00VUEwbWNjVThpL0tmTFMvNVZxaC9vK0NGNjhnMmtEendnS2U3aApydWxOOTE2RWIwOS82M2NHYlhCV0xuT0JxNmRlT3NhcVN4dzNkYmtWN1pGQy9GS3IvOWNOYndmMXhRa1NvRDlXCjRtVnJPNzRMQlRHQk9OMFhxanllVmYwbnBMTlZZUzVsZEU1UHhaM21QZk5oOWptcWpVcjBJZ2ViZHJVZm54QU8KaHZEOHJGbE1QTUlaWEdkTjlZUHBxb2srVTY0SnA1NHhkNWNiYk5XaXdYYXRJYjV4dnoremZ5VFluYXJlUmtoKwpFd3Rtd3VZMitra1pkelpTdTFKSXBua0ZNTUhQRzI0b2k5RzBvekpsUDIwcE5iMFVHWUU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://192.168.0.102:6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>kube-admin-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>kube-admin-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>k8s-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>preferences</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kube-admin-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJQ2RkVkJSRG9IM2t3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE16VXhOVEZhRncwek1UQTNNVE14TkRFM016VmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTJVYUpHMEN0VmhhS0hSeExURnFwbjlNaUcrUG8KdlZ6UGxZcXg0MXBCNk1DMmc1cHJ1MjBvdEwxWmxITkRFL01PQzNNNTVibjR0RDFzZUF5MjQ1ZEEzQUV6cml0UgovUEhNRzF3Ky9ZTTZiOTFQajd3cUd5UUE1dUNPTE1WbUYxQm5JbTRrSlNQUlNvRDFsZHMzcWFZeGl5VlpOT1VDClpXckR6NDh4Ry8wcG5PNDZNRGFNZ0VWS2VDU0ZhNm0zYjFaR1FWcEpqVi9HdVQ2QzhwOExucVBST0QzbkF3OXkKa1JnVm92MnlodGFwZXR6aDdVV2tTWHM3Vk5Gei9hM3pMT3FjQUdJa0plLzNXQ29iMTBPVG5Rbmg1Mms4SmphSgpzUm9JN2RLMURXMS9nT3crZDNKK2RkU0hYQTlreXF6UkZlWXJzaitRQTJHcFdab3RXbEJoWHVQWEJRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFMejNNOWRxNzJvSENkSW16ODIzMXNuY0N6ZVI2QlFFQUhWOVlzR3RqSnl0Nm54UAo2bW1ORVE2eCtpSjhSenRHanVwb2Z2aGtwdS91VGZ0MUtYbm1yaHg5N1FQbWtqaXZSVnVoMGxjVE01aWVldXZSCmxONklqbzgwUVBuR2c5Q0tMWndONHZmTnBPbUg3a2J4VzJDOWJWVmRyb1VjQmZ3QmJ1ejFtQjNnVVVYYlovMlAKL3lsRStpTW5OQ0xseGtFYXMrZnpoL0VmTzVLRE8wY0xFMDJIaEV2WEI1WkFEZUViZzlRdHFMNkZwOW9pVTRYbgpXcTR5Z1llV2NLWndyZ0hWWXpaOXQ5RkdlQUNnM0FLWHdwcDhDN3lDSE1EUWpmcnBsQzI5QU1WN2RHWjZ4azI0CmxSU3JiRVA4NVF1M0tUOUZyS0NaY3E1OWd2bm0xUEREVHJLaVI4VT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMlVhSkcwQ3RWaGFLSFJ4TFRGcXBuOU1pRytQb3ZWelBsWXF4NDFwQjZNQzJnNXByCnUyMG90TDFabEhOREUvTU9DM001NWJuNHREMXNlQXkyNDVkQTNBRXpyaXRSL1BITUcxdysvWU02YjkxUGo3d3EKR3lRQTV1Q09MTVZtRjFCbkltNGtKU1BSU29EMWxkczNxYVl4aXlWWk5PVUNaV3JEejQ4eEcvMHBuTzQ2TURhTQpnRVZLZUNTRmE2bTNiMVpHUVZwSmpWL0d1VDZDOHA4TG5xUFJPRDNuQXc5eWtSZ1ZvdjJ5aHRhcGV0emg3VVdrClNYczdWTkZ6L2EzekxPcWNBR0lrSmUvM1dDb2IxME9UblFuaDUyazhKamFKc1JvSTdkSzFEVzEvZ093K2QzSisKZGRTSFhBOWt5cXpSRmVZcnNqK1FBMkdwV1pvdFdsQmhYdVBYQlFJREFRQUJBb0lCQUVXbDVxMWx2aXFxYnZ1Rgo1bDFEY3J4WTRjWXUrSnc2OUEvcnRibzdaSVZId1RuT2RscE9VNDRjWkdyQngrN05LdU5ndkY1M2p0RzRIdDBjCnRrT2VhSndkaG9OK1Azbmx5SmU4cWpSNXJISFBiNEdUdjZ1VGp2WnpaUi9VNXpUeUFSMTRVUDNXelhBa2hwVFQKQUxUUklYQ0pPRjlNU2NoWXdRdjN5clkrSU9pOG5WZWNTTzFQWEtURlN0QUFoQitiNzFUeEdNbituOVUzNkw2YgpWb2kzdnhOTHpvRUttNlZvV2FhanFzUm4xTEdEU0RVcm80LzF2Y2Y4clc4NHlSSGREb2U3d1l3dWFUV3VYc1NICk54OCt1UnpucExCTTN3OFFmNTgvNkZlN1dVMVZDL0J6Z0RhZkMzT0hlS3p5eWUwRTFCaTVuU2N5aFV4VWxES1QKTnFvNE1BRUNnWUVBK2EzYlo2REtkUkdabmo0cWY4NVlCNmtzbzJCc293Z2orNHRTbVJEQkpoV2M1b1BqTk5wNQp6QS9iNGtjUGc4b1hNZlRzNkEvN1FDQk0rSytnRmk3R211akVPVmQrb2tLeTdDNnpmZnVPWHB6ZWVmS1hKM3JZClczbHRNQks2TEYrUDJQc3ZyYmtYb2RtTUNGditRcjlnOWhFQkFydWxRaVp6SVhSVWJ6aVM4TUVDZ1lFQTNzYXMKb3VkZmFvRTYrQk50YktqOGdLNENsbkZMaVoyMCtQNWFiRVFDOEdsRmlabjMxV2NGUHFzbGdEWXhTL3lGQ0dLUAphcFdiNDlZRjRMMnl0YXhmUlhneXc0VWlHNFJRSXlVVDhJSFRXQTkwdFFxb3dBc3NQeHBUR1hTMWRQTXNJQUlGCkFDLzU1ZDVQV1hReVJqTSt6MzVmUEZzOHZRQ0l1TUNuYU90eXMwVUNnWUVBK1VTR2VHWUIybkRRMGpnMFM5YWcKOGowR3NMRnlwQzFiWnlYSU44S1BZc3RQRXFCM2RHdnVEem1DQjkxejh0b080RFFyVk4rbnNuVE5BN2FxOTVxSgpjMXlSa3NIMFRtQ1NxdE5SSmFUQWxWcTlqamdRaWp6TnhqMXJNZ1J3VkI2dnlTdTFoUlgyTHdLM0dCMW5zaEhJCjVzRkJKZzVheGJrSFZrNENnZXVVWDhFQ2dZQXA2b0hUQ091NEUyYXdCSi9ESVN5WlhhUlpBQ294VTM0WWwyc1cKRWRubnVEY0FRL3NRcVJpZ2lQMCtXWFAvRXgxSXpacWtlRS9qbDRKMW5kdkJPUlNYOHB6Q2t3c3UyRDluelhNcAovcE53YjBBTFRGMGgvVGd2QzFuMVlUTS9OUDNwYTlmYkNDdmg1MmxRc0g5QkhDVkdUMFhHQ25pc0t5eU9icGxSCk1YUGNiUUtCZ1FEcXg0ODhyc2krT0Jlci81MHNWZE1lTWNsSzFEaVZER013VFR3ZmZBRFFlT1BaN00xaitaU04KRVhYMHpGZGN4Mk81TU1hWkFNY01DMHl6Nm9HV0lVODRWT3AxWjNoOGV5dS9Ec3F0Y1ZIUkxDSmcrWWlVZkR6QgpuKzFXeEtkTmVUc1h6L01JMi9QNlQyQ2NSUHRyT2JScTBDUzdidDgzVzlqZmdsRm5CeStwc0E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kube-admin-cluster2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJSjlXZmJjSVpYaWN3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNVEEzTVRVeE5URTRNamhhRncwek1UQTNNVE14TlRNd01ERmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXgzdElldjl4dHpoTVlmVG4zaFJBbXBnRys1RnMKOHlOUnQrK2IzMUpsM3R3KzkyaGdmeGwyTWc0cktVeWFyUkNkTGdwV0FiaHUyeDJTZUdTY0tWdGFoYVgyZ0xGMwpsVlVTVkhyWEZYQ2RSU1N4bnQ1eXQ0QUpwVlRMbGNPVVZtREtscEtvQi9VT1YrbGVKOFRydnJGWEU2ZWdBTzc1CnRKSkYxZURtbEVRR1F2WmxkRHM0RnNmeCtKelhhRXNpSTdySVM1MjJuUkdaa1dPaGZQU2lXYUVxRldlQU93MjIKMm5tNGVOS0VsMWtmNjlGL1pieHVVSDM3UDZmUEpQOG93QW44MG9EZFZOZm8yUWJTK29hZVMxK2hQNVJ2ZnErawozbDVlMGcrZ2c2ZnhxaWtrQXAySlNuRlJyYTNUdnRtRnBaeGo2NThDdE1xKzB0M3VqbDRNQk1CQ1JRSURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFENUpkM3NMYmpORGZ5Z0kxclNnNWRZU2FHNmJ2NDN0OUdhbHR0MDhBZGZYVjNVcgpHY0lYaEZBTkwwMFZ2VmxLdDlXbCtYcWRxWnNRYWhmZTNISk85WHV4RDVscGczUEQ5T01SVGUvWGM4NDYxbTBWCkpDMjMyODYzaFRyaFZrUnByakJDb3hwVDZTOWVkM2kvWEFERVptWDJWTkhIUSt2TmJZeXVlc2ZRSWxpbFJ3R24KbStmK01VMmN0UGlvek1UbFBWaWthL3FvTWd3V09RMEFockhJc2dOMnJiTmQrRFh2YVVIMytjY292UGN5b0dlNApVNlJta2FJMEZ4cG5PN3d1bzIyaEFOeVpHU2t6eE11WkVQMVBGbERpdFY3aWNNYWZTekR4MUdTampRQXNvekR1CmREWFVwVUFPeHNFc1QzdkZtR3ZBNHhpTXBScHNDK3NCNWdqNkJwZz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key-data</span><span class=p>:</span><span class=w> </span><span class=l>LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeDN0SWV2OXh0emhNWWZUbjNoUkFtcGdHKzVGczh5TlJ0KytiMzFKbDN0dys5MmhnCmZ4bDJNZzRyS1V5YXJSQ2RMZ3BXQWJodTJ4MlNlR1NjS1Z0YWhhWDJnTEYzbFZVU1ZIclhGWENkUlNTeG50NXkKdDRBSnBWVExsY09VVm1ES2xwS29CL1VPVitsZUo4VHJ2ckZYRTZlZ0FPNzV0SkpGMWVEbWxFUUdRdlpsZERzNApGc2Z4K0p6WGFFc2lJN3JJUzUyMm5SR1prV09oZlBTaVdhRXFGV2VBT3cyMjJubTRlTktFbDFrZjY5Ri9aYnh1ClVIMzdQNmZQSlA4b3dBbjgwb0RkVk5mbzJRYlMrb2FlUzEraFA1UnZmcStrM2w1ZTBnK2dnNmZ4cWlra0FwMkoKU25GUnJhM1R2dG1GcFp4ajY1OEN0TXErMHQzdWpsNE1CTUJDUlFJREFRQUJBb0lCQUJnT0h0UnVQMmxIeWJZNgpVVWV2aTRiWTlHYWJ4OWFlR0xta2xGaGUyRmdDbVRrK2hmeHR0cG9jcVVuR3FoUmFuNG13eDJSWHVFNkdCMmFyClEwV2RkWklPVEdhQ2dCZ3E5UlhvNWt6NGtvNkcrVUJlTk5rNkFHL0doUEpmYm1Eb05TWHBNNGdhSGd1dDRhUE0KRkYyZmh3K2d0Q1BJcmFYL3lab2NEOUlyVGRIL0s3Z0R4cHFkR2M3YUtmUXBvWHdjbWRFZGowL2JFMUhGZDlSUwpnZlpGcFp2RVNDcTlaQnluZVVWUHlTZVR5SlI0bWEzZEwzalJiWmZQTzlFcVNRbSsxbWZzYXhRU3k3K1JKKzY4Cmd2dGZCVVNGQ1l4N0JHemxiT1RHcHJ1em0vdGJXWHBrTCtxR1EwL3FHSllFd2dicFZ5YVo3WXV6N2RHT1VhdjcKSldBdzd4VUNnWUVBeTBkalV2NGliTGt4YjFlZkl0bE9uazZ3NFNlYzdtT1NNd3Y3c1dzSkpja0RkekRwMjMxNgpqRUg4dEEvTmswOEtRNS8vVDVFVGNmVnRqSWJhWmxRcDI0ZXAxOGdJUFJkN1RWbVgyN25FbkxBejJabzFMNUtwCmY0a0JOQUI3Y0J4M1JWYS81cHBJT0J0RDR6ekpwS1VQTFVFdGVUZ2VyOVVVTHVabkdQaWJCdWNDZ1lFQSt6ZkcKckorQjE2Z01rUmlmSGNmWU1qbVZwcXVTVFdncUVpaytjbUZ3VnVzL21IbGIxaDA2bFY0NUZWSG5tcm8zcWZVaQpQVXRDU29tWDYzZmlhWmwweG9rYXdVQUxZR1lTS1pxeTZFY2FJNEtTZ0NQaWtsS0wxbDd2cXFtbE5qV0N6dmdoCkVUaTQvbXZKMXBjUzQ5UytwSk9LRGJucFZDcWx5UXBRb2liY0EvTUNnWUFUcmppdWkwNDM2b0lmdm9MNHM4TkoKem1LUG1lODJvVXRCUi9LNVRaeVlIT3NKK2lGYUQ3N3luMXpnN2ZyQVBWSElGRkI2bXBnZ1cxdWMxRjJHdExWTQp2TWl6ekhrSHVTTkY3TnVuK1VkUXlEcHM0ZUl1VmV1MUhrV1FqRTluSGtwcDJ5ay9JVWJHcjlVVnhnZmJ1ZU5MClJWa3F1RVU0VHMvaWJvb2l2OGI2bHdLQmdRRGJHbWR1RVdSR2Vld1Q5Sng2ZGQxSzJNeDc1RElpenhHNmF6eHEKdUM4cHI5MzBsd3dRNzhjemxVMUdHZnhkQjhNYXVaRVdVbmhMMkR1bkJCVjFzb0NWMCtpQTJlSFNQdFBpYzJsTQppdzd5SDZTMG5CZTFOTWQvdmFkY2VyOThTeWwrYUEwM0h2akI5YkxCTlZ3bFYxeTYzMjlOejNNQWxIMnBuUlI4CmlGWG1Id0tCZ1FERFQycnU1RHRZU21PWTdzSzVwSFBvNVRja3B5K0hCWXJCRjVHaFQ2b2RWSHRhZW5KMG9mWS8KMHd0SkQ3VWlrU21zcmM0Y0h4ODQraXdvd0NyQVhXV2hDVDhQc2k5SHAwRUhVNWtSd3VPUWM0Z1RhQ3hvYytuOQp4UkJxMlFmS0NGeXhSQkZjY1ZaU3FDdENoWlQvaUMvZFBQMUJFNGR3RXdPYnBxdkxnRHJtVHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=演示设置-context>演示：设置 context</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 查看当前的 cluster 和 context</span>
</span></span><span class=line><span class=cl>&gt; kubectl config get-contexts
</span></span><span class=line><span class=cl>CURRENT   NAME           CLUSTER        AUTHINFO              NAMESPACE
</span></span><span class=line><span class=cl>*         k8s-cluster1   k8s-cluster1   kube-admin-cluster1
</span></span><span class=line><span class=cl>          k8s-cluster2   k8s-cluster2   kube-admin-cluster2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 查看当前 context 中的 cluster 中的 节点资源</span>
</span></span><span class=line><span class=cl>&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME            STATUS   ROLES                      AGE   VERSION
</span></span><span class=line><span class=cl>192.168.0.101   Ready    controlplane,etcd,worker   17h   v1.20.8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 切换 context 为 k8s-cluster2</span>
</span></span><span class=line><span class=cl>kubectl config use-context k8s-cluster2
</span></span><span class=line><span class=cl>Switched to context <span class=s2>&#34;k8s-cluster2&#34;</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 再次查看当前的 cluster 和 context</span>
</span></span><span class=line><span class=cl>&gt; kubectl config get-contexts
</span></span><span class=line><span class=cl>CURRENT   NAME           CLUSTER        AUTHINFO              NAMESPACE
</span></span><span class=line><span class=cl>          k8s-cluster1   k8s-cluster1   kube-admin-cluster1
</span></span><span class=line><span class=cl>*         k8s-cluster2   k8s-cluster2   kube-admin-cluster2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 查看当前 context 中的 cluster 中的 节点资源</span>
</span></span><span class=line><span class=cl>&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME            STATUS   ROLES                      AGE   VERSION
</span></span><span class=line><span class=cl>192.168.0.102   Ready    controlplane,etcd,worker   16h   v1.20.8
</span></span></code></pre></td></tr></table></div></div><h2 id=namespace>namespace</h2><h3 id=定义-namespace>定义 namespace</h3><p>2.1 create-pod-with-namespace.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=演示创建-namespace>演示：创建 namespace</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 获取当前 k8s 中的 namespace</span>
</span></span><span class=line><span class=cl>&gt; kubectl get Namespace
</span></span><span class=line><span class=cl>NAME              STATUS   AGE
</span></span><span class=line><span class=cl>default           Active   16h
</span></span><span class=line><span class=cl>ingress-nginx     Active   16h
</span></span><span class=line><span class=cl>kube-node-lease   Active   16h
</span></span><span class=line><span class=cl>kube-public       Active   16h
</span></span><span class=line><span class=cl>kube-system       Active   16h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 创建 namespace demo</span>
</span></span><span class=line><span class=cl>&gt; kubectl create namespace demo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. create pod with namespace</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;2.1 create-pod-with-namespace.yaml&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 根据 namespace 过滤 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod --namespace demo                                                             NAME    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>nginx   1/1     Running   <span class=m>0</span>          61s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 删除 namespace demo</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete namespace demo
</span></span><span class=line><span class=cl>namespace <span class=s2>&#34;demo&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h2 id=pod>Pod</h2><h3 id=定义-pod>定义 pod</h3><p>3.1 pod definition.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=s2>&#34;while true;do echo hello;sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=演示创建-pod>演示：创建 pod</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 根据 yaml 创建 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;3.1 pod definition.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/nginx-busybox created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 获取当前 k8s 中的 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pods
</span></span><span class=line><span class=cl>NAME            READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>nginx-busybox   2/2     Running   <span class=m>0</span>          112s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 pod 的详细信息</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe pod nginx-busybox
</span></span><span class=line><span class=cl>Name:         nginx-busybox
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Priority:     <span class=m>0</span>
</span></span><span class=line><span class=cl>Node:         192.168.0.102/192.168.0.102
</span></span><span class=line><span class=cl>Start Time:   Fri, <span class=m>16</span> Jul <span class=m>2021</span> 17:07:26 +0800
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  cni.projectcalico.org/podIP: 10.42.0.13/32
</span></span><span class=line><span class=cl>              cni.projectcalico.org/podIPs: 10.42.0.13/32
</span></span><span class=line><span class=cl>Status:       Running
</span></span><span class=line><span class=cl>IP:           10.42.0.13
</span></span><span class=line><span class=cl>IPs:
</span></span><span class=line><span class=cl>  IP:  10.42.0.13
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  nginx:
</span></span><span class=line><span class=cl>    Container ID:   docker://2faf5c6ca9a8693b3d79a74aceb428e95ab3eab8ff08d5c3e2dbb5b0cba4fb0a
</span></span><span class=line><span class=cl>    Image:          nginx
</span></span><span class=line><span class=cl>    Image ID:       docker-pullable://nginx@sha256:353c20f74d9b6aee359f30e8e4f69c3d7eaea2f610681c4a95849a2fd7c497f9
</span></span><span class=line><span class=cl>    Port:           80/TCP
</span></span><span class=line><span class=cl>    Host Port:      0/TCP
</span></span><span class=line><span class=cl>    State:          Running
</span></span><span class=line><span class=cl>      Started:      Fri, <span class=m>16</span> Jul <span class=m>2021</span> 17:07:44 +0800
</span></span><span class=line><span class=cl>    Ready:          True
</span></span><span class=line><span class=cl>    Restart Count:  <span class=m>0</span>
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-z429d <span class=o>(</span>ro<span class=o>)</span>
</span></span><span class=line><span class=cl>  busybox:
</span></span><span class=line><span class=cl>    Container ID:  docker://40fb9f0aad6828f12a64f3b5ac54f481808a45d759359a85ff1fa9f1f66f5281
</span></span><span class=line><span class=cl>    Image:         busybox
</span></span><span class=line><span class=cl>    Image ID:      docker-pullable://busybox@sha256:0f354ec1728d9ff32edcd7d1b8bbdfc798277ad36120dc3dc683be44524c8b60
</span></span><span class=line><span class=cl>    Port:          &lt;none&gt;
</span></span><span class=line><span class=cl>    Host Port:     &lt;none&gt;
</span></span><span class=line><span class=cl>    Command:
</span></span><span class=line><span class=cl>      /bin/sh
</span></span><span class=line><span class=cl>    Args:
</span></span><span class=line><span class=cl>      -c
</span></span><span class=line><span class=cl>      <span class=k>while</span> true<span class=p>;</span><span class=k>do</span> <span class=nb>echo</span> hello<span class=p>;</span>sleep 10<span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl>    State:          Running
</span></span><span class=line><span class=cl>      Started:      Fri, <span class=m>16</span> Jul <span class=m>2021</span> 17:08:03 +0800
</span></span><span class=line><span class=cl>    Ready:          True
</span></span><span class=line><span class=cl>    Restart Count:  <span class=m>0</span>
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-z429d <span class=o>(</span>ro<span class=o>)</span>
</span></span><span class=line><span class=cl>Conditions:
</span></span><span class=line><span class=cl>  Type              Status
</span></span><span class=line><span class=cl>  Initialized       True
</span></span><span class=line><span class=cl>  Ready             True
</span></span><span class=line><span class=cl>  ContainersReady   True
</span></span><span class=line><span class=cl>  PodScheduled      True
</span></span><span class=line><span class=cl>Volumes:
</span></span><span class=line><span class=cl>  default-token-z429d:
</span></span><span class=line><span class=cl>    Type:        Secret <span class=o>(</span>a volume populated by a Secret<span class=o>)</span>
</span></span><span class=line><span class=cl>    SecretName:  default-token-z429d
</span></span><span class=line><span class=cl>    Optional:    <span class=nb>false</span>
</span></span><span class=line><span class=cl>QoS Class:       BestEffort
</span></span><span class=line><span class=cl>Node-Selectors:  &lt;none&gt;
</span></span><span class=line><span class=cl>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>                 node.kubernetes.io/unreachable:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type    Reason     Age    From               Message
</span></span><span class=line><span class=cl>  ----    ------     ----   ----               -------
</span></span><span class=line><span class=cl>  Normal  Scheduled  3m51s  default-scheduler  Successfully assigned default/nginx-busybox to 192.168.0.102
</span></span><span class=line><span class=cl>  Normal  Pulling    3m50s  kubelet            Pulling image <span class=s2>&#34;nginx&#34;</span>
</span></span><span class=line><span class=cl>  Normal  Pulled     3m33s  kubelet            Successfully pulled image <span class=s2>&#34;nginx&#34;</span> in 16.825562979s
</span></span><span class=line><span class=cl>  Normal  Created    3m33s  kubelet            Created container nginx
</span></span><span class=line><span class=cl>  Normal  Started    3m33s  kubelet            Started container nginx
</span></span><span class=line><span class=cl>  Normal  Pulling    3m33s  kubelet            Pulling image <span class=s2>&#34;busybox&#34;</span>
</span></span><span class=line><span class=cl>  Normal  Pulled     3m14s  kubelet            Successfully pulled image <span class=s2>&#34;busybox&#34;</span> in 18.599300936s
</span></span><span class=line><span class=cl>  Normal  Created    3m14s  kubelet            Created container busybox
</span></span><span class=line><span class=cl>  Normal  Started    3m14s  kubelet            Started container busybox
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 按指定格式输出 pod 信息，-o 可选参数：wide、json、yaml</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pods nginx-busybox -o wide
</span></span><span class=line><span class=cl>NAME            READY   STATUS    RESTARTS   AGE     IP           NODE            NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>nginx-busybox   2/2     Running   <span class=m>0</span>          5m57s   10.42.0.13   192.168.0.102   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 进入某个 pod 容器内部</span>
</span></span><span class=line><span class=cl><span class=c1>## 注意：如果一个pod中有多个容器，默认是进第一个容器。如果想进入其它容器，可以通过 -c 参数指定</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> nginx-busybox -it sh
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> <span class=o>[</span>POD<span class=o>]</span> <span class=o>[</span>COMMAND<span class=o>]</span> is DEPRECATED and will be removed in a future version. Use kubectl <span class=nb>exec</span> <span class=o>[</span>POD<span class=o>]</span> -- <span class=o>[</span>COMMAND<span class=o>]</span> instead.
</span></span><span class=line><span class=cl>Defaulting container name to nginx.
</span></span><span class=line><span class=cl>Use <span class=s1>&#39;kubectl describe pod/nginx-busybox -n default&#39;</span> to see all of the containers in this pod.
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 在 pod 中执行 linux 命令(date)</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> nginx-busybox -- date
</span></span><span class=line><span class=cl>Defaulting container name to nginx.
</span></span><span class=line><span class=cl>Use <span class=s1>&#39;kubectl describe pod/nginx-busybox -n default&#39;</span> to see all of the containers in this pod.
</span></span><span class=line><span class=cl>Fri Jul <span class=m>16</span> 09:27:17 UTC <span class=m>2021</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 7. 在第二个容器（busybox）中执行 linux 命令(date)</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> nginx-busybox -c busybox -- date
</span></span><span class=line><span class=cl>Fri Jul <span class=m>16</span> 09:28:04 UTC <span class=m>2021</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 8. 根据 yaml 删除 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;3.1 pod definition.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;nginx-busybox&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h2 id=deployment>deployment</h2><h3 id=41-nginx_deploymdnetyml>4.1 nginx_deploymdnet.yml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w> </span><span class=c># for versions before 1.9.0 use apps/v1beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=c># tells deployment to run 2 pods matching the template</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class=c># create pods using pod definition in this template</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># unlike pod-nginx.yaml, the name is not included in the meta data as a unique name is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># generated from the deployment name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=42-nginx_deployment_updateyml>4.2 nginx_deployment_update.yml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w> </span><span class=c># for versions before 1.9.0 use apps/v1beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.8</span><span class=w> </span><span class=c># Update the version of nginx from 1.7.9 to 1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=43-nginx_deployment_scaleyml>4.3 nginx_deployment_scale.yml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w> </span><span class=c># for versions before 1.9.0 use apps/v1beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w> </span><span class=c># Update the replicas from 2 to 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=演示创建-deployment>演示：创建 deployment</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 1. 创建 deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl create -f &#34;4.1 nginx_deploymdnet.yml&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment created</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 2. 查看当前 k8s 中的 pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                                READY   STATUS    RESTARTS   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-4whs2   1/1     Running   0          3m32s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-j9p9b   1/1     Running   0          3m32s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 3. 根据标签 nginx 筛选 pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>kubectl get pod -l app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                                READY   STATUS    RESTARTS   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-4whs2   1/1     Running   0          3m59s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-j9p9b   1/1     Running   0          3m59s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 4. 获取 deployment（nginx-deployment）的信息，按照 wide 模式输出</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get deployment nginx-deployment -o wide</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME               READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES        SELECTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment   2/2     2            2           5m10s   nginx        nginx:1.7.9   app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 5. 演示：deployment 自动维护 pod 的数量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## 5.1 手动删除 pod nginx-deployment-5d59d67564-4whs2，并</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl delete pod nginx-deployment-5d59d67564-4whs2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pod &#34;nginx-deployment-5d59d67564-4whs2&#34; deleted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## 5.2 观察 pod 的状态，说明 deployment 会自动维护 pod 的数量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get pod -l app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                                READY   STATUS    RESTARTS   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-j9p9b   1/1     Running   0          9m15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-5d59d67564-k8bbt   1/1     Running   0          38s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 6. 更新 nginx版本（从1.7.9 到 1.8）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl apply -f &#34;4.2 nginx_deployment_update.yml&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Warning</span><span class=p>:</span><span class=w> </span><span class=l>resource deployments/nginx-deployment is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment configured</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get deployment nginx-deployment -o wide</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES      SELECTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment   2/2     1            2           15m   nginx        nginx:1.8   app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 7. 伸缩 pod 数量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl apply -f &#34;4.3 nginx_deployment_scale.yml&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment configured</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get pod -l app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                                READY   STATUS    RESTARTS   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-64c9d67564-6mclw   1/1     Running   0          15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-64c9d67564-8ch7n   1/1     Running   0          113s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-64c9d67564-db7mv   1/1     Running   0          15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-64c9d67564-ffhs6   1/1     Running   0          2m45s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 8. 通过 vim 更新 deployment(修改pod数量为3)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl edit deployment nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 9. 通过 kubectl 命令伸缩 deployment（将 pod 数量从 3 变为 4）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl scale --current-replicas=3 --replicas=4 deployment/nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment scaled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get deployment nginx-deployment -o wide</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES      SELECTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment   4/4     4            4           30m   nginx        nginx:1.8   app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 10. 通过命令行更新 deployment 中 nginx 的 image 版本（从1.8变为1.7.9）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl set image deployment/nginx-deployment nginx=1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment image updated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get deployment nginx-deployment -o wide</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES   SELECTOR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment   4/4     3            4           34m   nginx        1.7.9    app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 11. 获取 replilcaset</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl get replicaset</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                          DESIRED   CURRENT   READY   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>nginx-deployment-64c9d67564   4         4         4       7s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 12. 获取 replicaset 的更新状态</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl set image deployment/nginx-deployment nginx=1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment image updated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl rollout status deployment nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 13. 查看 deployment 的更新历史及版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl rollout history deployment nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>REVISION  CHANGE-CAUSE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=m>1</span><span class=w>         </span><span class=l>&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=m>2</span><span class=w>         </span><span class=l>&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=m>3</span><span class=w>         </span><span class=l>&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 14. 回滚 deployment 的到特定版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl rollout history deployment nginx-deployment --revision 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment with revision</span><span class=w> </span><span class=c>#2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Pod Template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>Labels:	app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=l>pod-template-hash=64c9d67564</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>Containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Image:	nginx:1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Port:	80/TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Host Port:	0/TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Environment:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Mounts:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>Volumes:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl rollout history deployment nginx-deployment --revision 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment with revision</span><span class=w> </span><span class=c>#3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Pod Template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>Labels:	app=nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=l>pod-template-hash=5dd569b986</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>Containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Image:	1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Port:	80/TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Host Port:	0/TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Environment:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>Mounts:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>Volumes:	&lt;none&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 15. 回滚 deployment 的到上一版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl rollout undo deployment nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps/nginx-deployment rolled back</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 16. 删除 deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>&gt; kubectl delete deployment nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>deployment.apps &#34;nginx-deployment&#34; deleted</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=service>Service</h2><h3 id=service-介绍>Service 介绍</h3><p>由于一些原因，导致 pod 不方便提供服务，比如：</p><ul><li>pod 的数量可能随时会增加/减少</li><li>pod 的ip地址随时可能会发生变化</li></ul><p>因此，需要使用 Servce，通过 label 筛选，将抽象的一组 pod 组织起来，对外提供服务。</p><h3 id=service-类型>Service 类型</h3><ul><li>ClusterIP(默认)</li><li>NodePort</li><li>LoadBalancer</li></ul><table><thead><tr><th>对比项</th><th>ClusterIP</th><th>NodePort</th><th>LoadBalancer</th></tr></thead><tbody><tr><td>是否默认</td><td>是</td><td>否</td><td>否</td></tr><tr><td>集群内任意节点可访问</td><td>是</td><td></td><td></td></tr><tr><td>实现原理</td><td>基于iptables的链</td><td>在所有节点（虚拟机）上开放一个特定端口，任何发送到该端口的流量都被转发到对应服务。</td><td>端口转发</td></tr><tr><td>应用场景</td><td>集群内访问</td><td>开发调试</td><td>云厂商环境/生产环境</td></tr></tbody></table><h3 id=501-podyaml>5.0.1 pod.yaml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=502-busyboxyaml>5.0.2 busybox.yaml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod-busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=51-clusteripyaml>5.1 ClusterIP.yaml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=52-nodeportyaml>5.2 NodePort.yaml</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=演示service>演示：Service</h3><h4 id=演示创建-clusterip-类型的-service>演示：创建 ClusterIP 类型的 Service</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 准备工作：创建pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/pod-nginx created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 创建 ClusterIP 类型的 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.1 ClusterIP.yaml&#34;</span>
</span></span><span class=line><span class=cl>service/service-nginx created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 Service 列表</span>
</span></span><span class=line><span class=cl>&gt; kubectl get svc
</span></span><span class=line><span class=cl>NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>kubernetes      ClusterIP   10.43.0.1      &lt;none&gt;        443/TCP    3d16h
</span></span><span class=line><span class=cl>service-nginx   ClusterIP   10.43.73.249   &lt;none&gt;        8080/TCP   18s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 根据 Service 的 ClusterIP 和  port 访问 Service</span>
</span></span><span class=line><span class=cl>&gt; curl 10.43.73.249:8080
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>    body <span class=o>{</span>
</span></span><span class=line><span class=cl>        width: 35em<span class=p>;</span>
</span></span><span class=line><span class=cl>        margin: <span class=m>0</span> auto<span class=p>;</span>
</span></span><span class=line><span class=cl>        font-family: Tahoma, Verdana, Arial, sans-serif<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class=line><span class=cl>working. Further configuration is required.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;For online documentation and support please refer to
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class=line><span class=cl>Commercial support is available at
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;em&gt;Thank you <span class=k>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 删除 Service</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.1 方法一：根据 yaml 删除 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;5.1 ClusterIP.yaml&#34;</span>
</span></span><span class=line><span class=cl>&gt; service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 4.2 方法二：使用命令删除 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete svc service-nginx
</span></span><span class=line><span class=cl>service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 删除 pod</span>
</span></span><span class=line><span class=cl><span class=c1>## 5.1 方法一：根据 yaml 删除 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 5.2 方法二：使用命令行删除 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod-nginx   1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-nginx
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h4 id=演示创建-nodeport-类型的-service>演示：创建 NodePort 类型的 Service</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 准备工作：创建pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/pod-nginx created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 创建 NodePort 类型的 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.2 NodePort.yaml&#34;</span>
</span></span><span class=line><span class=cl>service/service-nginx created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 Service 列表</span>
</span></span><span class=line><span class=cl>&gt; kubectl get svc
</span></span><span class=line><span class=cl>NAME            TYPE        CLUSTER-IP    EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>          AGE
</span></span><span class=line><span class=cl>kubernetes      ClusterIP   10.43.0.1     &lt;none&gt;        443/TCP          3d16h
</span></span><span class=line><span class=cl>service-nginx   NodePort    10.43.36.91   &lt;none&gt;        8080:32008/TCP   22s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 使用 任意 Node 的IP 和 转发端口（32008）访问 Service</span>
</span></span><span class=line><span class=cl>&gt; curl 192.168.0.101:32008
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>    body <span class=o>{</span>
</span></span><span class=line><span class=cl>        width: 35em<span class=p>;</span>
</span></span><span class=line><span class=cl>        margin: <span class=m>0</span> auto<span class=p>;</span>
</span></span><span class=line><span class=cl>        font-family: Tahoma, Verdana, Arial, sans-serif<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class=line><span class=cl>working. Further configuration is required.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;For online documentation and support please refer to
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class=line><span class=cl>Commercial support is available at
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;em&gt;Thank you <span class=k>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 删除 Service</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.1 方法一：根据 yaml 删除 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;5.1 ClusterIP.yaml&#34;</span>
</span></span><span class=line><span class=cl>&gt; service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 4.2 方法二：使用命令删除 Service</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete svc service-nginx
</span></span><span class=line><span class=cl>service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 删除 pod</span>
</span></span><span class=line><span class=cl><span class=c1>## 5.1 方法一：根据 yaml 删除 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 5.2 方法二：使用命令行删除 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod-nginx   1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-nginx
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h4 id=演示创建-loadbalancer-类型的-service>演示：创建 LoadBalancer 类型的 Service</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 将 pod 的 type 更改为 LoadBalancer</span>
</span></span><span class=line><span class=cl>&gt; kubectl expose pod nginx-pod --type<span class=o>=</span>LoadBalancer
</span></span><span class=line><span class=cl>service <span class=s2>&#34;nginx-pod&#34;</span> exposed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 通过 DNS Name 访问 LoadBalancer 类型的 Service</span>
</span></span><span class=line><span class=cl>&gt; curl <span class=s2>&#34;DNS Name&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=演示service-auto-discovery>演示：Service Auto Discovery</h3><h4 id=演示检查-k8s-环境是否支持-service-autodiscovery>演示：检查 k8s 环境是否支持 Service AutoDiscovery</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 检查是否存在 coredns 或 kubedns，如果不存在，则不支持 Service Auto Discovery，需要手动安装</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod -o wide -n kube-system                                   ─╯
</span></span><span class=line><span class=cl>NAME                                       READY   STATUS      RESTARTS   AGE     IP              NODE            NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>calico-kube-controllers-7d5d95c8c9-hhwnq   1/1     Running     <span class=m>2</span>          3d17h   10.42.0.15      192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>canal-sn6f8                                2/2     Running     <span class=m>4</span>          3d17h   192.168.0.101   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>coredns-55b58f978-7qc92                    1/1     Running     <span class=m>2</span>          3d17h   10.42.0.12      192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>coredns-autoscaler-76f8869cc9-2pmch        1/1     Running     <span class=m>2</span>          3d17h   10.42.0.16      192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>metrics-server-55fdd84cd4-64tqc            1/1     Running     <span class=m>2</span>          3d17h   10.42.0.13      192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rke-coredns-addon-deploy-job-cmt88         0/1     Completed   <span class=m>0</span>          3d17h   192.168.0.101   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rke-ingress-controller-deploy-job-tpg8q    0/1     Completed   <span class=m>0</span>          3d17h   192.168.0.101   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rke-metrics-addon-deploy-job-j9j6s         0/1     Completed   <span class=m>0</span>          3d17h   192.168.0.101   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rke-network-plugin-deploy-job-6rrjk        0/1     Completed   <span class=m>0</span>          3d17h   192.168.0.101   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h4 id=演示基于-dns-实现-service-auto-discovery>演示：基于 DNS 实现 Service Auto Discovery</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 环境准备</span>
</span></span><span class=line><span class=cl><span class=c1>## 1.1 创建 pod nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>&gt; pod/pod-nginx created
</span></span><span class=line><span class=cl><span class=c1>## 1.2 创建 pod busybox</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.2 busybox.yaml&#34;</span>
</span></span><span class=line><span class=cl>&gt; pod/pod-busybox created
</span></span><span class=line><span class=cl><span class=c1>## 1.3 创建 service</span>
</span></span><span class=line><span class=cl>&gt; kubectl expose pod pod-nginx --name service-nginx
</span></span><span class=line><span class=cl>service/service-nginx exposed
</span></span><span class=line><span class=cl><span class=c1>## 1.4 查看 service 列表及 Service 对应的 ip地址</span>
</span></span><span class=line><span class=cl>&gt; kubectl get svc
</span></span><span class=line><span class=cl>NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>kubernetes      ClusterIP   10.43.0.1      &lt;none&gt;        443/TCP   3d19h
</span></span><span class=line><span class=cl>service-nginx   ClusterIP   10.43.203.20   &lt;none&gt;        80/TCP    64s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 演示 基于 DNS 实现 Service Auto Discovery</span>
</span></span><span class=line><span class=cl><span class=c1>## 2.1 获取 pod 列表</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod -o wide
</span></span><span class=line><span class=cl>NAME          READY   STATUS    RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>pod-busybox   1/1     Running   <span class=m>0</span>          27s   10.42.0.21   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>pod-nginx     1/1     Running   <span class=m>0</span>          11m   10.42.0.19   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.2 进入 pod busybox 内部</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it pod-busybox -- sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.3 查看容器的ip地址</span>
</span></span><span class=line><span class=cl>/ <span class=c1># ip a</span>
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>    inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>3: eth0@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu <span class=m>1450</span> qdisc noqueue
</span></span><span class=line><span class=cl>    link/ether 86:fe:52:2b:9e:ef brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 10.42.0.21/32 brd 10.42.0.21 scope global eth0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.4 测试 到 pod-nginx(10.42.0.19) 网络联通性</span>
</span></span><span class=line><span class=cl>/ <span class=c1># ping 10.42.0.19</span>
</span></span><span class=line><span class=cl>PING 10.42.0.19 <span class=o>(</span>10.42.0.19<span class=o>)</span>: <span class=m>56</span> data bytes
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.42.0.19: <span class=nv>seq</span><span class=o>=</span><span class=m>0</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>0.324 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.42.0.19: <span class=nv>seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>0.108 ms
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>--- 10.42.0.19 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>3</span> packets transmitted, <span class=m>3</span> packets received, 0% packet loss
</span></span><span class=line><span class=cl>round-trip min/avg/max <span class=o>=</span> 0.085/0.172/0.324 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.5 查看 dns server的 ip 地址</span>
</span></span><span class=line><span class=cl>/ <span class=c1># more /etc/resolv.conf</span>
</span></span><span class=line><span class=cl>nameserver 10.43.0.10
</span></span><span class=line><span class=cl>search default.svc.cluster.local svc.cluster.local cluster.local
</span></span><span class=line><span class=cl>options ndots:5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.6 通过 ping 获取 service-nginx 的 ip地址</span>
</span></span><span class=line><span class=cl>/ <span class=c1># ping service-nginx(可以解析出 service-nginx 对应的 ip 地址为 10.43.203.20)</span>
</span></span><span class=line><span class=cl>PING service-nginx <span class=o>(</span>10.43.203.20<span class=o>)</span>: <span class=m>56</span> data bytes
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>--- service-nginx ping statistics ---
</span></span><span class=line><span class=cl><span class=m>19</span> packets transmitted, <span class=m>0</span> packets received, 100% packet loss
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 2.7 通过 nslookup 命令 获取 service-nginx 的 ip 地址</span>
</span></span><span class=line><span class=cl>/ <span class=c1># nslookup service-nginx</span>
</span></span><span class=line><span class=cl>nslookup service-nginx
</span></span><span class=line><span class=cl>Server:		10.43.0.10
</span></span><span class=line><span class=cl>Address:	10.43.0.10:53
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:	service-nginx.default.svc.cluster.local
</span></span><span class=line><span class=cl>Address: 10.43.203.20
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 kube-dns 的 ip 地址</span>
</span></span><span class=line><span class=cl>&gt; kubectl get svc -n kube-system
</span></span><span class=line><span class=cl>NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>                  AGE
</span></span><span class=line><span class=cl>kube-dns         ClusterIP   10.43.0.10     &lt;none&gt;        53/UDP,53/TCP,9153/TCP   3d19h
</span></span><span class=line><span class=cl>metrics-server   ClusterIP   10.43.70.165   &lt;none&gt;        443/TCP                  3d19h
</span></span><span class=line><span class=cl><span class=c1>## 注意：这里获取到的 kube-dns 的 ip 地址是 10.43.0.10，与上一步在 busybox pod中获取到的 dns server 的 ip 地址相同</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 清理演示环境</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.1 删除 service service-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete svc service-nginx
</span></span><span class=line><span class=cl>service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 4.2 删除 pod pod-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-nginx
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 4.3 删除 pod pod-bysybox</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-busybox
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-busybox&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h4 id=演示基于-环境变量-实现-service-auto-discovery>演示：基于 环境变量 实现 Service Auto Discovery</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 环境准备（注意：顺序很重要，busybox必须最后创建）</span>
</span></span><span class=line><span class=cl><span class=c1>## 1.1 创建 pod pod-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.1 pod.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/pod-nginx created
</span></span><span class=line><span class=cl><span class=c1>## 1.2 创建 service service-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.1 ClusterIP.yaml&#34;</span>
</span></span><span class=line><span class=cl>service/service-nginx created
</span></span><span class=line><span class=cl><span class=c1>## 1.3 创建 pod pod-busybox</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;5.0.2 busybox.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/pod-busybox created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 输出 pod pod-busybox 中的环境变量(可以得到 service-nginx有关的环境变量)</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> pod-busybox -- env                                           
</span></span><span class=line><span class=cl><span class=nv>PATH</span><span class=o>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></span><span class=line><span class=cl><span class=nv>HOSTNAME</span><span class=o>=</span>pod-busybox
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_SERVICE_PORT</span><span class=o>=</span><span class=m>443</span>
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_PORT_443_TCP</span><span class=o>=</span>tcp://10.43.0.1:443
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_PORT_443_TCP_ADDR</span><span class=o>=</span>10.43.0.1
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_PORT_8080_TCP</span><span class=o>=</span>tcp://10.43.167.52:8080
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_PORT_8080_TCP_PORT</span><span class=o>=</span><span class=m>8080</span>
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_PORT_8080_TCP_ADDR</span><span class=o>=</span>10.43.167.52
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_SERVICE_HOST</span><span class=o>=</span>10.43.0.1
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_SERVICE_HOST</span><span class=o>=</span>10.43.167.52
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_PORT_8080_TCP_PROTO</span><span class=o>=</span>tcp
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_PORT_443_TCP_PROTO</span><span class=o>=</span>tcp
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_PORT</span><span class=o>=</span>tcp://10.43.0.1:443
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_SERVICE_PORT</span><span class=o>=</span><span class=m>8080</span>
</span></span><span class=line><span class=cl><span class=nv>SERVICE_NGINX_PORT</span><span class=o>=</span>tcp://10.43.167.52:8080
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_SERVICE_PORT_HTTPS</span><span class=o>=</span><span class=m>443</span>
</span></span><span class=line><span class=cl><span class=nv>KUBERNETES_PORT_443_TCP_PORT</span><span class=o>=</span><span class=m>443</span>
</span></span><span class=line><span class=cl><span class=nv>HOME</span><span class=o>=</span>/root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 清理演示环境</span>
</span></span><span class=line><span class=cl><span class=c1>## 3.1 删除 service service-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete svc service-nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>service <span class=s2>&#34;service-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 3.2 删除 pod pod-nginx</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-nginx&#34;</span> deleted
</span></span><span class=line><span class=cl><span class=c1>## 3.3 删除 pod pod-busybox</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod pod-busybox
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;pod-busybox&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h2 id=health-check>Health Check</h2><h3 id=health-check-介绍>Health Check 介绍</h3><p>健康检查通过探针的方式，可以检测 pod 的健康状态，当 pod 状态不健康时，避免把请求转发给不健康的 pod。</p><h3 id=探针支持的类型>探针支持的类型</h3><p>探针按照方式支持三种类型，分别是：</p><ul><li>HTTP</li><li>Command</li><li>TCP</li></ul><h3 id=http-方式探针示例>HTTP 方式探针示例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/healthz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prot</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>httpHeaders</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>X-Custom-Header</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>Awesome</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=command-方式探针示例>Command 方式探针示例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/tmp.healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=tcp-方式探针示例>TCP 方式探针示例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tcpSocket</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=health-check-中两种探针的对比>Health Check 中两种探针的对比</h3><table><thead><tr><th>对比项</th><th>Liveness Probe</th><th>readiness Probe</th></tr></thead><tbody><tr><td>配置和参数</td><td>相同</td><td>相同</td></tr><tr><td>探测失败后的行为</td><td>重启容器</td><td>把容器标记为 Unready，不接受请求</td></tr><tr><td>依赖性</td><td>而至是相互独立，没有依赖，既可以独立使用，也可以同时使用</td><td>同 Liveness Probe</td></tr><tr><td>作用</td><td>判断是否需要重启以实现自愈</td><td>判断容器是否准备好对外提供服务</td></tr><tr><td>初始值</td><td>成功，防止应用在没成功启动前，被误杀</td><td>失败，防止应用还没准备好，有请求进来</td></tr><tr><td>默认值</td><td>二者没有配置的话，默认状态都是成功</td><td>-</td></tr><tr><td>返回值</td><td>返回值在[200,400]范围内认为成功，返回值 5xx认为失败</td><td>同 Liveness Probe</td></tr></tbody></table><ul><li>二者不能相互替代，根据实际情况，配合使用。</li><li>只配置了 readiness 是无法出发容器重启的。</li><li>只配置了 liveness，可能应用还没准备好，导致请求失败，status 是 running，Ready 是 0/1。</li></ul><h3 id=liveness-probe-配置示例>Liveness Probe 配置示例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=l>HTTP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>   </span><span class=c># 表示延迟30S开始第一次探测，默认值是0，最小值是0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>35</span><span class=w>        </span><span class=c># 表示每次探测的超时时间，35S后如果没返回结果就认为超时失败，默认值是1，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>         </span><span class=c># 表示多久进行一次探测，默认是10S，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>       </span><span class=c># 表示在探测失败后，最小的连续成功被认为是成功的，默认值是1，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>       </span><span class=c># 表示当探测失败时，Kubernetes将在认为失败前尝试failureThreshold次数。默认值是3，最小值是1;Liveness认为失败的操作是重启pod，而readiness认为失败的操作是把pod标记为 Unready</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=readness-probe-配置示例>readness probe 配置示例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>httpGet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=l>HTTP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>   </span><span class=c># 表示延迟30S开始第一次探测，默认值是0，最小值是0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>35</span><span class=w>        </span><span class=c># 表示每次探测的超时时间，35S后如果没返回结果就认为超时失败，默认值是1，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>         </span><span class=c># 表示多久进行一次探测，默认是10S，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>successThreshold</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>       </span><span class=c># 表示在探测失败后，最小的连续成功被认为是成功的，默认值是1，最小值是1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>       </span><span class=c># 表示当探测失败时，Kubernetes将在认为失败前尝试failureThreshold次数。默认值是3，最小值是1;Liveness认为失败的操作是重启pod，而readiness认为失败的操作是把pod标记为 Unready</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ingress>Ingress</h2><h3 id=ingress-resource>Ingress Resource</h3><h4 id=name-based-routing>Name based routing</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>go-app-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>demo.infracloud.space</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>demo-go-app-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=path-based-routing>Path based routing</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>go-app-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>demo.infracloud.space</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>demo-go-app-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/canary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>demo-go-app-canary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=ingress-controller>Ingress Controller</h3><p>通用的 Ingress Controller：</p><ul><li>Nginx</li><li>Traefik</li><li>HAproxy</li><li>Envoy</li></ul><h2 id=volumes>Volumes</h2><h3 id=hostpath>hostPath</h3><h4 id=定义-hostpath>定义 hostPath</h4><p>8.1 hostPath.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-pd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/test-pd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/test-pd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># directory location on host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># this field is optional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DirectoryOrCreate</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=演示创建-hostpath>演示：创建 hostPath</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 准备环境</span>
</span></span><span class=line><span class=cl>&gt; mkdir -p /data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 创建 pod</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.1 hostPath.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/test-pd created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 pod 列表</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod -o wide
</span></span><span class=line><span class=cl>NAME      READY   STATUS    RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>test-pd   2/2     Running   <span class=m>0</span>          44s   10.42.0.25   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 演示 hostPath</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.1 从 /data 创建文件</span>
</span></span><span class=line><span class=cl>&gt; <span class=nb>cd</span> /data
</span></span><span class=line><span class=cl>&gt; <span class=nb>echo</span> <span class=s2>&#34;test0 from /data&#34;</span> &gt;&gt; <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.2 从 pod busybox1 创建文件</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it test-pd -- sh
</span></span><span class=line><span class=cl>Defaulted container <span class=s2>&#34;busybox1&#34;</span> out of: busybox1, busybox2
</span></span><span class=line><span class=cl>/ <span class=c1># cd /test-pd/</span>
</span></span><span class=line><span class=cl>/test-pd <span class=c1># ls</span>
</span></span><span class=line><span class=cl><span class=nb>test</span>
</span></span><span class=line><span class=cl>/test-pd <span class=c1># echo &#34;test1 from busybox1&#34; &gt;&gt; test</span>
</span></span><span class=line><span class=cl>/test-pd <span class=c1># exit</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.3 从 pod busybox2 创建文件</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it test-pd -c busybox2 -- sh
</span></span><span class=line><span class=cl>/ <span class=c1># cd /test-pd</span>
</span></span><span class=line><span class=cl>/test-pd <span class=c1># echo &#34;test2 from busybox2&#34; &gt;&gt; test</span>
</span></span><span class=line><span class=cl>/test-pd <span class=c1># exit</span>
</span></span><span class=line><span class=cl><span class=c1>## 4.4 从 /data 查看测试文件</span>
</span></span><span class=line><span class=cl>&gt; <span class=nb>cd</span> /data
</span></span><span class=line><span class=cl>&gt; more <span class=nb>test</span>
</span></span><span class=line><span class=cl>test0 from /data
</span></span><span class=line><span class=cl>test1 from busybox1
</span></span><span class=line><span class=cl>test2 from busybox2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 删除演示环境</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod test-pd
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;test-pd&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h3 id=pvc--pv>PVC & PV</h3><p><code>PVC</code>是一个用户请求，用于向 Kubernetes 申请存储资源。Kubernetes收到申请以后，会由 Storage.Class 自动分配 <code>PV</code></p><h4 id=821-pvcyaml>8.2.1 pvc.yaml</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PersistentVolumeClaim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>hello-pvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>20Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=822-pvc-mysqlyaml>8.2.2 pvc-mysql.yaml</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PersistentVolumeClaim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-volumeclaim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>20Gi</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=823-mysqlyaml>8.2.3 mysql.yaml</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_ROOT_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-persistent-storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-persistent-storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class=l>mysql-volumeclaim</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=演示创建pvc--pv>演示：创建pvc & pv</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 创建 pvc</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.2.1 pvc.yaml&#34;</span>
</span></span><span class=line><span class=cl>persistentvolumeclaim/hello-pvc created
</span></span><span class=line><span class=cl><span class=c1># 2. 获取 pvc 列表(本次实验环境由于没有配置 Storage.Class，所以pvc一直是pending状态，如果配置 Storage.Class，则正常应该是 Bound 状态)</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pvc
</span></span><span class=line><span class=cl>NAME        STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class=line><span class=cl>hello-pvc   Pending                                                     73s
</span></span><span class=line><span class=cl><span class=c1># 3. 获取 pv(由于上一步的pvc一直是pending状态，所以pv就无法正常分配)</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pv
</span></span><span class=line><span class=cl>No resources found
</span></span><span class=line><span class=cl><span class=c1># 4. 清理演示环境(删除pvc，所有相应的pv也会被删除)</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pvc hello-pvc
</span></span><span class=line><span class=cl>persistentvolumeclaim <span class=s2>&#34;hello-pvc&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h4 id=演示mysql使用pvc>演示：mysql使用pvc</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 创建 mysql 的pvc</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.2.2 pvc-mysql.yaml&#34;</span>
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-volumeclaim created
</span></span><span class=line><span class=cl><span class=c1># 2. 创建 mysql</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.2.3 mysql.yaml&#34;</span>
</span></span><span class=line><span class=cl>deployment.apps/mysql created
</span></span><span class=line><span class=cl><span class=c1># 3. 清理演示环境</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete deployment mysql
</span></span><span class=line><span class=cl>deployment.apps <span class=s2>&#34;mysql&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete pvc mysql-volumeclaim
</span></span><span class=line><span class=cl>persistentvolumeclaim <span class=s2>&#34;mysql-volumeclaim&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h3 id=secret>Secret</h3><h4 id=overview>overview</h4><ul><li>可以通过 volume 或 环境变量的形式访问 Secret</li><li>Secret 存储在 tmpfs volumes，这种volumes实际上是在内存中维护了一些文件</li><li>每个Secret最大限制 1MB</li><li>API Server 会把 Secret 存储在 etcd</li></ul><h4 id=命令行创建-secret-语法>命令行创建 Secret 语法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 查看帮助</span>
</span></span><span class=line><span class=cl>&gt; kubectl create secret --help
</span></span><span class=line><span class=cl>Create a secret using specified subcommand.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Available Commands:
</span></span><span class=line><span class=cl>  docker-registry 创建一个给 Docker registry 使用的 secret
</span></span><span class=line><span class=cl>  generic         从本地 file, directory 或者 literal value 创建一个 secret
</span></span><span class=line><span class=cl>  tls             创建一个 TLS secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage:
</span></span><span class=line><span class=cl>  kubectl create secret <span class=o>[</span>flags<span class=o>]</span> <span class=o>[</span>options<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Use <span class=s2>&#34;kubectl &lt;command&gt; --help&#34;</span> <span class=k>for</span> more information about a given command.
</span></span><span class=line><span class=cl>Use <span class=s2>&#34;kubectl options&#34;</span> <span class=k>for</span> a list of global command-line options <span class=o>(</span>applies to all commands<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 查看 generic 的帮助</span>
</span></span><span class=line><span class=cl>&gt; kubectl create secret generic --help
</span></span><span class=line><span class=cl>Create a secret based on a file, directory, or specified literal value.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> A single secret may package one or more key/value pairs.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> When creating a secret based on a file, the key will default to the basename of the file, and the value will default to
</span></span><span class=line><span class=cl>the file content. If the basename is an invalid key or you wish to chose your own, you may specify an alternate key.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> When creating a secret based on a directory, each file whose basename is a valid key in the directory will be packaged
</span></span><span class=line><span class=cl>into the secret. Any directory entries except regular files are ignored <span class=o>(</span>e.g. subdirectories, symlinks, devices, pipes,
</span></span><span class=line><span class=cl>etc<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Examples:
</span></span><span class=line><span class=cl>  <span class=c1># Create a new secret named my-secret with keys for each file in folder bar</span>
</span></span><span class=line><span class=cl>  kubectl create secret generic my-secret --from-file<span class=o>=</span>path/to/bar
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new secret named my-secret with specified keys instead of names on disk</span>
</span></span><span class=line><span class=cl>  kubectl create secret generic my-secret --from-file<span class=o>=</span>ssh-privatekey<span class=o>=</span>path/to/id_rsa
</span></span><span class=line><span class=cl>--from-file<span class=o>=</span>ssh-publickey<span class=o>=</span>path/to/id_rsa.pub
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new secret named my-secret with key1=supersecret and key2=topsecret</span>
</span></span><span class=line><span class=cl>  kubectl create secret generic my-secret --from-literal<span class=o>=</span><span class=nv>key1</span><span class=o>=</span>supersecret --from-literal<span class=o>=</span><span class=nv>key2</span><span class=o>=</span>topsecret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new secret named my-secret using a combination of a file and a literal</span>
</span></span><span class=line><span class=cl>  kubectl create secret generic my-secret --from-file<span class=o>=</span>ssh-privatekey<span class=o>=</span>path/to/id_rsa --from-literal<span class=o>=</span><span class=nv>passphrase</span><span class=o>=</span>topsecret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new secret named my-secret from an env file</span>
</span></span><span class=line><span class=cl>  kubectl create secret generic my-secret --from-env-file<span class=o>=</span>path/to/bar.env
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>      --allow-missing-template-keys<span class=o>=</span>true: If true, ignore any errors in templates when a field or map key is missing in
</span></span><span class=line><span class=cl>the template. Only applies to golang and jsonpath output formats.
</span></span><span class=line><span class=cl>      --append-hash<span class=o>=</span>false: Append a <span class=nb>hash</span> of the secret to its name.
</span></span><span class=line><span class=cl>      --dry-run<span class=o>=</span><span class=s1>&#39;none&#39;</span>: Must be <span class=s2>&#34;none&#34;</span>, <span class=s2>&#34;server&#34;</span>, or <span class=s2>&#34;client&#34;</span>. If client strategy, only print the object that would be
</span></span><span class=line><span class=cl>sent, without sending it. If server strategy, submit server-side request without persisting the resource.
</span></span><span class=line><span class=cl>      --field-manager<span class=o>=</span><span class=s1>&#39;kubectl-create&#39;</span>: Name of the manager used to track field ownership.
</span></span><span class=line><span class=cl>      --from-env-file<span class=o>=</span><span class=s1>&#39;&#39;</span>: Specify the path to a file to <span class=nb>read</span> lines of <span class=nv>key</span><span class=o>=</span>val pairs to create a secret <span class=o>(</span>i.e. a Docker
</span></span><span class=line><span class=cl>.env file<span class=o>)</span>.
</span></span><span class=line><span class=cl>      --from-file<span class=o>=[]</span>: Key files can be specified using their file path, in which <span class=k>case</span> a default name will be given to
</span></span><span class=line><span class=cl>them, or optionally with a name and file path, in which <span class=k>case</span> the given name will be used.  Specifying a directory will
</span></span><span class=line><span class=cl>iterate each named file in the directory that is a valid secret key.
</span></span><span class=line><span class=cl>      --from-literal<span class=o>=[]</span>: Specify a key and literal value to insert in secret <span class=o>(</span>i.e. <span class=nv>mykey</span><span class=o>=</span>somevalue<span class=o>)</span>
</span></span><span class=line><span class=cl>  -o, --output<span class=o>=</span><span class=s1>&#39;&#39;</span>: Output format. One of:
</span></span><span class=line><span class=cl>json<span class=p>|</span>yaml<span class=p>|</span>name<span class=p>|</span>go-template<span class=p>|</span>go-template-file<span class=p>|</span>template<span class=p>|</span>templatefile<span class=p>|</span>jsonpath<span class=p>|</span>jsonpath-as-json<span class=p>|</span>jsonpath-file.
</span></span><span class=line><span class=cl>      --save-config<span class=o>=</span>false: If true, the configuration of current object will be saved in its annotation. Otherwise, the
</span></span><span class=line><span class=cl>annotation will be unchanged. This flag is useful when you want to perform kubectl apply on this object in the future.
</span></span><span class=line><span class=cl>      --template<span class=o>=</span><span class=s1>&#39;&#39;</span>: Template string or path to template file to use when -o<span class=o>=</span>go-template, -o<span class=o>=</span>go-template-file. The
</span></span><span class=line><span class=cl>template format is golang templates <span class=o>[</span>http://golang.org/pkg/text/template/#pkg-overview<span class=o>]</span>.
</span></span><span class=line><span class=cl>      --type<span class=o>=</span><span class=s1>&#39;&#39;</span>: 创建 secret 类型资源
</span></span><span class=line><span class=cl>      --validate<span class=o>=</span>true: If true, use a schema to validate the input before sending it
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage:
</span></span><span class=line><span class=cl>  kubectl create secret generic NAME <span class=o>[</span>--type<span class=o>=</span>string<span class=o>]</span> <span class=o>[</span>--from-file<span class=o>=[</span><span class=nv>key</span><span class=o>=]</span>source<span class=o>]</span> <span class=o>[</span>--from-literal<span class=o>=</span><span class=nv>key1</span><span class=o>=</span>value1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--dry-run<span class=o>=</span>server<span class=p>|</span>client<span class=p>|</span>none<span class=o>]</span> <span class=o>[</span>options<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Use <span class=s2>&#34;kubectl options&#34;</span> <span class=k>for</span> a list of global command-line options <span class=o>(</span>applies to all commands<span class=o>)</span>.
</span></span></code></pre></td></tr></table></div></div><h4 id=演示使用-secret>演示：使用 secret</h4><p>8.3.1 create-secret.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>root-password</span><span class=p>:</span><span class=w> </span><span class=l>d2FuZ2xpYmluZwo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>no-root-password</span><span class=p>:</span><span class=w> </span><span class=l>d2FuZ2xpYmluZwo=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># echo &#34;wanglibing&#34; | base64 = d2FuZ2xpYmluZwo=</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>8.3.2 use-secret-from-volume.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret-busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/tmp/apikey&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>my-secret</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>8.3.3 use-secret-from-env.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_ROOT_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>root-password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 准备环境（创建secret）</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.3.1 create-secret.yaml&#34;</span>
</span></span><span class=line><span class=cl>secret/my-secret created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 演示：通过 volume 方式使用 secret</span>
</span></span><span class=line><span class=cl><span class=c1>## 2.1 创建 pod</span>
</span></span><span class=line><span class=cl>kubectl create -f <span class=s2>&#34;8.3.2 use-secret-from-volume.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/secret-busybox created
</span></span><span class=line><span class=cl><span class=c1>## 2.2 检查 pod 状态是否 Ready</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME             READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>secret-busybox   1/1     Running   <span class=m>0</span>          25s
</span></span><span class=line><span class=cl><span class=c1>## 2.3 进入 pod 容器</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it secret-busybox -- sh
</span></span><span class=line><span class=cl>/ <span class=c1># cd /tmp/apikey</span>
</span></span><span class=line><span class=cl>/tmp/apikey <span class=c1># ls</span>
</span></span><span class=line><span class=cl>no-root-password  root-password
</span></span><span class=line><span class=cl>/tmp/apikey <span class=c1># more root-password</span>
</span></span><span class=line><span class=cl>wanglibing
</span></span><span class=line><span class=cl>/tmp/apikey <span class=c1># more no-root-password</span>
</span></span><span class=line><span class=cl>wanglibing
</span></span><span class=line><span class=cl>/tmp/apikey <span class=c1># exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 演示：通过 环境变量 方式使用 secret</span>
</span></span><span class=line><span class=cl><span class=c1>## 3.1 创建 pod mysql</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.3.3 use-secret-from-env.yaml&#34;</span>
</span></span><span class=line><span class=cl>deployment.apps/mysql created
</span></span><span class=line><span class=cl><span class=c1>## 3.2 检查 pod 状态是否 Ready</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>mysql-6787d4d46c-bt48p   1/1     Running   <span class=m>1</span>          104s
</span></span><span class=line><span class=cl>secret-busybox           1/1     Running   <span class=m>0</span>          5m32s
</span></span><span class=line><span class=cl><span class=c1>## 3.3 进入 pod mysql 容器</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it mysql-6787d4d46c-bt48p -- sh
</span></span><span class=line><span class=cl><span class=c1>## 3.4 连接 mysql</span>
</span></span><span class=line><span class=cl><span class=c1># mysql -u root -pwanglibing</span>
</span></span><span class=line><span class=cl>mysql&gt; <span class=nb>exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 清理演示环境</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;8.3.3 use-secret-from-env.yaml&#34;</span>
</span></span><span class=line><span class=cl>deployment.apps <span class=s2>&#34;mysql&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;8.3.2 use-secret-from-volume.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;secret-busybox&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete -f <span class=s2>&#34;8.3.1 create-secret.yaml&#34;</span>
</span></span><span class=line><span class=cl>secret <span class=s2>&#34;my-secret&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h3 id=configmap>ConfigMap</h3><h4 id=configmap-语法>configmap 语法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; kubectl create configmap -h
</span></span><span class=line><span class=cl>Create a configmap based on a file, directory, or specified literal value.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> A single configmap may package one or more key/value pairs.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> When creating a configmap based on a file, the key will default to the basename of the file, and the value will default
</span></span><span class=line><span class=cl>to the file content.  If the basename is an invalid key, you may specify an alternate key.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> When creating a configmap based on a directory, each file whose basename is a valid key in the directory will be
</span></span><span class=line><span class=cl>packaged into the configmap.  Any directory entries except regular files are ignored <span class=o>(</span>e.g. subdirectories, symlinks,
</span></span><span class=line><span class=cl>devices, pipes, etc<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Aliases:
</span></span><span class=line><span class=cl>configmap, cm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Examples:
</span></span><span class=line><span class=cl>  <span class=c1># Create a new configmap named my-config based on folder bar</span>
</span></span><span class=line><span class=cl>  kubectl create configmap my-config --from-file<span class=o>=</span>path/to/bar
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new configmap named my-config with specified keys instead of file basenames on disk</span>
</span></span><span class=line><span class=cl>  kubectl create configmap my-config --from-file<span class=o>=</span><span class=nv>key1</span><span class=o>=</span>/path/to/bar/file1.txt --from-file<span class=o>=</span><span class=nv>key2</span><span class=o>=</span>/path/to/bar/file2.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new configmap named my-config with key1=config1 and key2=config2</span>
</span></span><span class=line><span class=cl>  kubectl create configmap my-config --from-literal<span class=o>=</span><span class=nv>key1</span><span class=o>=</span>config1 --from-literal<span class=o>=</span><span class=nv>key2</span><span class=o>=</span>config2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new configmap named my-config from the key=value pairs in the file</span>
</span></span><span class=line><span class=cl>  kubectl create configmap my-config --from-file<span class=o>=</span>path/to/bar
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Create a new configmap named my-config from an env file</span>
</span></span><span class=line><span class=cl>  kubectl create configmap my-config --from-env-file<span class=o>=</span>path/to/bar.env
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>      --allow-missing-template-keys<span class=o>=</span>true: If true, ignore any errors in templates when a field or map key is missing in
</span></span><span class=line><span class=cl>the template. Only applies to golang and jsonpath output formats.
</span></span><span class=line><span class=cl>      --append-hash<span class=o>=</span>false: Append a <span class=nb>hash</span> of the configmap to its name.
</span></span><span class=line><span class=cl>      --dry-run<span class=o>=</span><span class=s1>&#39;none&#39;</span>: Must be <span class=s2>&#34;none&#34;</span>, <span class=s2>&#34;server&#34;</span>, or <span class=s2>&#34;client&#34;</span>. If client strategy, only print the object that would be
</span></span><span class=line><span class=cl>sent, without sending it. If server strategy, submit server-side request without persisting the resource.
</span></span><span class=line><span class=cl>      --field-manager<span class=o>=</span><span class=s1>&#39;kubectl-create&#39;</span>: Name of the manager used to track field ownership.
</span></span><span class=line><span class=cl>      --from-env-file<span class=o>=</span><span class=s1>&#39;&#39;</span>: Specify the path to a file to <span class=nb>read</span> lines of <span class=nv>key</span><span class=o>=</span>val pairs to create a configmap <span class=o>(</span>i.e. a Docker
</span></span><span class=line><span class=cl>.env file<span class=o>)</span>.
</span></span><span class=line><span class=cl>      --from-file<span class=o>=[]</span>: Key file can be specified using its file path, in which <span class=k>case</span> file basename will be used as
</span></span><span class=line><span class=cl>configmap key, or optionally with a key and file path, in which <span class=k>case</span> the given key will be used.  Specifying a directory
</span></span><span class=line><span class=cl>will iterate each named file in the directory whose basename is a valid configmap key.
</span></span><span class=line><span class=cl>      --from-literal<span class=o>=[]</span>: Specify a key and literal value to insert in configmap <span class=o>(</span>i.e. <span class=nv>mykey</span><span class=o>=</span>somevalue<span class=o>)</span>
</span></span><span class=line><span class=cl>  -o, --output<span class=o>=</span><span class=s1>&#39;&#39;</span>: Output format. One of:
</span></span><span class=line><span class=cl>json<span class=p>|</span>yaml<span class=p>|</span>name<span class=p>|</span>go-template<span class=p>|</span>go-template-file<span class=p>|</span>template<span class=p>|</span>templatefile<span class=p>|</span>jsonpath<span class=p>|</span>jsonpath-as-json<span class=p>|</span>jsonpath-file.
</span></span><span class=line><span class=cl>      --save-config<span class=o>=</span>false: If true, the configuration of current object will be saved in its annotation. Otherwise, the
</span></span><span class=line><span class=cl>annotation will be unchanged. This flag is useful when you want to perform kubectl apply on this object in the future.
</span></span><span class=line><span class=cl>      --template<span class=o>=</span><span class=s1>&#39;&#39;</span>: Template string or path to template file to use when -o<span class=o>=</span>go-template, -o<span class=o>=</span>go-template-file. The
</span></span><span class=line><span class=cl>template format is golang templates <span class=o>[</span>http://golang.org/pkg/text/template/#pkg-overview<span class=o>]</span>.
</span></span><span class=line><span class=cl>      --validate<span class=o>=</span>true: If true, use a schema to validate the input before sending it
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage:
</span></span><span class=line><span class=cl>  kubectl create configmap NAME <span class=o>[</span>--from-file<span class=o>=[</span><span class=nv>key</span><span class=o>=]</span>source<span class=o>]</span> <span class=o>[</span>--from-literal<span class=o>=</span><span class=nv>key1</span><span class=o>=</span>value1<span class=o>]</span> <span class=o>[</span>--dry-run<span class=o>=</span>server<span class=p>|</span>client<span class=p>|</span>none<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>options<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Use <span class=s2>&#34;kubectl options&#34;</span> <span class=k>for</span> a list of global command-line options <span class=o>(</span>applies to all commands<span class=o>)</span>.
</span></span></code></pre></td></tr></table></div></div><h4 id=演示创建-configmap>演示：创建 configmap</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 通过 键值对 方式创建 configmap</span>
</span></span><span class=line><span class=cl>&gt; kubectl create configmap configmap-1 --from-literal<span class=o>=</span><span class=nv>host</span><span class=o>=</span>127.0.0.1 --from-literal<span class=o>=</span><span class=nv>port</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl>configmap/configmap-1 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 获取 configmap 列表</span>
</span></span><span class=line><span class=cl>&gt; kubectl get configmap
</span></span><span class=line><span class=cl>NAME               DATA   AGE
</span></span><span class=line><span class=cl>configmap-1        <span class=m>2</span>      60s
</span></span><span class=line><span class=cl>kube-root-ca.crt   <span class=m>1</span>      4d13h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 查看 configmap 的详细信息</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe configmap configmap-1
</span></span><span class=line><span class=cl>Name:         configmap-1
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>host:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>127.0.0.1
</span></span><span class=line><span class=cl>port:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl><span class=m>3000</span>
</span></span><span class=line><span class=cl>Events:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 通过 文件导入的方式创建 configmap</span>
</span></span><span class=line><span class=cl>&gt; kubectl create configmap configmap2configmap2 --from-file<span class=o>=</span>8.4.0.bootstrap.yaml
</span></span><span class=line><span class=cl>configmap/configmap2 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 查看 configmap2 的详细信息</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe configmap configmap2
</span></span><span class=line><span class=cl>Name:         configmap2
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>8.4.0.bootstrap.yaml:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>server:
</span></span><span class=line><span class=cl>  port: <span class=m>9002</span>
</span></span><span class=line><span class=cl>spring:
</span></span><span class=line><span class=cl>  application:
</span></span><span class=line><span class=cl>    name: report-sso
</span></span><span class=line><span class=cl>    logging:
</span></span><span class=line><span class=cl>      level:
</span></span><span class=line><span class=cl>        root: INFO
</span></span><span class=line><span class=cl>        org.springframework.web: INFO
</span></span><span class=line><span class=cl>        org.springframework.security: INFO
</span></span><span class=line><span class=cl>        org.springframework.security.oauth2: INFO
</span></span><span class=line><span class=cl>  cloud:
</span></span><span class=line><span class=cl>    nacos:
</span></span><span class=line><span class=cl>      <span class=c1># 分布式配置</span>
</span></span><span class=line><span class=cl>      config:
</span></span><span class=line><span class=cl>        <span class=c1># Data ID</span>
</span></span><span class=line><span class=cl>        prefix: com.wanglibing.report-sso.yaml
</span></span><span class=line><span class=cl>        <span class=c1># 配置格式</span>
</span></span><span class=line><span class=cl>        file-extension: yaml
</span></span><span class=line><span class=cl>        <span class=c1># Nacos Server</span>
</span></span><span class=line><span class=cl>        server-addr: 172.16.18.206:8848
</span></span><span class=line><span class=cl>        refresh:
</span></span><span class=line><span class=cl>          <span class=c1># 是否开启动态刷新</span>
</span></span><span class=line><span class=cl>          enable: <span class=nb>false</span>
</span></span><span class=line><span class=cl>      <span class=c1># 服务发现</span>
</span></span><span class=line><span class=cl>      discovery:
</span></span><span class=line><span class=cl>        <span class=c1># Nacos Server</span>
</span></span><span class=line><span class=cl>        server-addr: 172.16.18.206:8848
</span></span><span class=line><span class=cl>        enabled: <span class=nb>false</span>
</span></span><span class=line><span class=cl>    kubernetes:
</span></span><span class=line><span class=cl>      config:
</span></span><span class=line><span class=cl>        name: name-config
</span></span><span class=line><span class=cl>        namespace: default
</span></span><span class=line><span class=cl>      reload:
</span></span><span class=line><span class=cl>        enabled: <span class=nb>true</span>
</span></span><span class=line><span class=cl>        mode: polling
</span></span><span class=line><span class=cl>        period: <span class=m>5000</span>
</span></span><span class=line><span class=cl>        strategy: shutdown
</span></span><span class=line><span class=cl>        monitoring-secrets: <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=c1># 自定义属性，用于测试不同环境的值变化</span>
</span></span><span class=line><span class=cl>com:
</span></span><span class=line><span class=cl>  wanglibing:
</span></span><span class=line><span class=cl>    name: <span class=s2>&#34;kevin-prod&#34;</span>
</span></span><span class=line><span class=cl>    address: <span class=s2>&#34;北京-prod&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Events:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 删除演示环境</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete configmap configmap2
</span></span><span class=line><span class=cl>configmap <span class=s2>&#34;configmap2&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete configmap configmap-1
</span></span><span class=line><span class=cl>configmap <span class=s2>&#34;configmap-1&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h4 id=演示使用-configmap>演示：使用 configmap</h4><p>8.4.1 configmap-from-literal.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3000&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>8.4.2 configmap-pod-volume.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox-2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>8.4.3 configmao-pod-env.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;while true; do echo hello; sleep 10;done&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>HOST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>port</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 创建 configmap config-1</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.4.1 configmap-from-literal.yaml&#34;</span>
</span></span><span class=line><span class=cl>configmap/config-1 created
</span></span><span class=line><span class=cl><span class=c1># 2. 查看 config-1 的详细信息</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe configmap config-1
</span></span><span class=line><span class=cl>Name:         config-1
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>host:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>127.0.0.1
</span></span><span class=line><span class=cl>port:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl><span class=m>3000</span>
</span></span><span class=line><span class=cl>Events:  &lt;none&gt;
</span></span><span class=line><span class=cl><span class=c1># 3. 创建 pod（使用 volume 的方式使用 configmap）</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.4.2 configmap-pod-volume.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/busybox-2 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 查看 pod 的状态是否 Ready</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>busybox-2   1/1     Running   <span class=m>0</span>          27s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 进入 pod 内部查看 configmap</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it busybox-2 -- sh
</span></span><span class=line><span class=cl>/ <span class=c1># cd /etc/config/</span>
</span></span><span class=line><span class=cl>/etc/config <span class=c1># ls</span>
</span></span><span class=line><span class=cl>host  port
</span></span><span class=line><span class=cl>/etc/config <span class=c1># more host</span>
</span></span><span class=line><span class=cl>127.0.0.1/etc/config <span class=c1># more port</span>
</span></span><span class=line><span class=cl>3000/etc/config <span class=c1># exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 创建 pod（使用环境变量的方式使用 configmap） busybox-1</span>
</span></span><span class=line><span class=cl>&gt; kubectl create -f <span class=s2>&#34;8.4.3 configmao-pod-env.yaml&#34;</span>
</span></span><span class=line><span class=cl>pod/busybox-1 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 7. 检查 busybox-1 的状态是否 Ready</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod
</span></span><span class=line><span class=cl>NAME        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>busybox-1   1/1     Running   <span class=m>0</span>          2m8s
</span></span><span class=line><span class=cl>busybox-2   1/1     Running   <span class=m>0</span>          11m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 8. 进入 pod busybox-1 读取 configmap</span>
</span></span><span class=line><span class=cl>&gt; kubectl <span class=nb>exec</span> -it busybox-1 -- sh
</span></span><span class=line><span class=cl>/ <span class=c1># echo $HOST</span>
</span></span><span class=line><span class=cl>127.0.0.1
</span></span><span class=line><span class=cl>/ <span class=c1># echo $PORT</span>
</span></span><span class=line><span class=cl><span class=m>3000</span>
</span></span><span class=line><span class=cl>/ <span class=c1># exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 9. 清理演示环境</span>
</span></span><span class=line><span class=cl>&gt; kubectl delete pod busybox-1
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;busybox-1&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete pod busybox-2
</span></span><span class=line><span class=cl>pod <span class=s2>&#34;busybox-2&#34;</span> deleted
</span></span><span class=line><span class=cl>&gt; kubectl delete configmap config-1
</span></span><span class=line><span class=cl>configmap <span class=s2>&#34;config-1&#34;</span> deleted
</span></span></code></pre></td></tr></table></div></div><h2 id=debug>Debug</h2><h3 id=pod-一直是-containercreating-状态>pod 一直是 ContainerCreating 状态</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. pod 一直是 ContainerCreating 状态</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pod -o wide -w
</span></span><span class=line><span class=cl>NAME      READY   STATUS              RESTARTS   AGE   IP       NODE            NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>test-pd   0/2     ContainerCreating   <span class=m>0</span>          7m    &lt;none&gt;   192.168.0.101   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl><span class=c1># 2. 使用 kubectl describe 排查问题</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe pod test-pd                                                                                                          ─╯
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:         test-pd
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Priority:     <span class=m>0</span>
</span></span><span class=line><span class=cl>Node:         192.168.0.101/192.168.0.101
</span></span><span class=line><span class=cl>Start Time:   Mon, <span class=m>19</span> Jul <span class=m>2021</span> 20:41:51 +0800
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>Status:       Pending
</span></span><span class=line><span class=cl>IP:
</span></span><span class=line><span class=cl>IPs:          &lt;none&gt;
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  busybox1:
</span></span><span class=line><span class=cl>    Container ID:
</span></span><span class=line><span class=cl>    Image:         busybox
</span></span><span class=line><span class=cl>    Image ID:
</span></span><span class=line><span class=cl>    Port:          &lt;none&gt;
</span></span><span class=line><span class=cl>    Host Port:     &lt;none&gt;
</span></span><span class=line><span class=cl>    Command:
</span></span><span class=line><span class=cl>      /bin/sh
</span></span><span class=line><span class=cl>    Args:
</span></span><span class=line><span class=cl>      -c
</span></span><span class=line><span class=cl>      <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> hello<span class=p>;</span> sleep 10<span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl>    State:          Waiting
</span></span><span class=line><span class=cl>      Reason:       ContainerCreating
</span></span><span class=line><span class=cl>    Ready:          False
</span></span><span class=line><span class=cl>    Restart Count:  <span class=m>0</span>
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /test-pd from test-volume <span class=o>(</span>rw<span class=o>)</span>
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dxh92 <span class=o>(</span>ro<span class=o>)</span>
</span></span><span class=line><span class=cl>  busybox2:
</span></span><span class=line><span class=cl>    Container ID:
</span></span><span class=line><span class=cl>    Image:         busybox
</span></span><span class=line><span class=cl>    Image ID:
</span></span><span class=line><span class=cl>    Port:          &lt;none&gt;
</span></span><span class=line><span class=cl>    Host Port:     &lt;none&gt;
</span></span><span class=line><span class=cl>    Command:
</span></span><span class=line><span class=cl>      /bin/sh
</span></span><span class=line><span class=cl>    Args:
</span></span><span class=line><span class=cl>      -c
</span></span><span class=line><span class=cl>      <span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> hello<span class=p>;</span> sleep 10<span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl>    State:          Waiting
</span></span><span class=line><span class=cl>      Reason:       ContainerCreating
</span></span><span class=line><span class=cl>    Ready:          False
</span></span><span class=line><span class=cl>    Restart Count:  <span class=m>0</span>
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /test-pd from test-volume <span class=o>(</span>rw<span class=o>)</span>
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dxh92 <span class=o>(</span>ro<span class=o>)</span>
</span></span><span class=line><span class=cl>Conditions:
</span></span><span class=line><span class=cl>  Type              Status
</span></span><span class=line><span class=cl>  Initialized       True
</span></span><span class=line><span class=cl>  Ready             False
</span></span><span class=line><span class=cl>  ContainersReady   False
</span></span><span class=line><span class=cl>  PodScheduled      True
</span></span><span class=line><span class=cl>Volumes:
</span></span><span class=line><span class=cl>  test-volume:
</span></span><span class=line><span class=cl>    Type:          HostPath <span class=o>(</span>bare host directory volume<span class=o>)</span>
</span></span><span class=line><span class=cl>    Path:          /data
</span></span><span class=line><span class=cl>    HostPathType:  Directory
</span></span><span class=line><span class=cl>  default-token-dxh92:
</span></span><span class=line><span class=cl>    Type:        Secret <span class=o>(</span>a volume populated by a Secret<span class=o>)</span>
</span></span><span class=line><span class=cl>    SecretName:  default-token-dxh92
</span></span><span class=line><span class=cl>    Optional:    <span class=nb>false</span>
</span></span><span class=line><span class=cl>QoS Class:       BestEffort
</span></span><span class=line><span class=cl>Node-Selectors:  &lt;none&gt;
</span></span><span class=line><span class=cl>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>                 node.kubernetes.io/unreachable:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type     Reason       Age                    From               Message
</span></span><span class=line><span class=cl>  ----     ------       ----                   ----               -------
</span></span><span class=line><span class=cl>  Normal   Scheduled    10m                    default-scheduler  Successfully assigned default/test-pd to 192.168.0.101
</span></span><span class=line><span class=cl>  Warning  FailedMount  3m27s <span class=o>(</span>x3 over 7m57s<span class=o>)</span>  kubelet            Unable to attach or mount volumes: unmounted <span class=nv>volumes</span><span class=o>=[</span>test-volume<span class=o>]</span>, unattached <span class=nv>volumes</span><span class=o>=[</span>test-volume default-token-dxh92<span class=o>]</span>: timed out waiting <span class=k>for</span> the condition
</span></span><span class=line><span class=cl>  Warning  FailedMount  106s <span class=o>(</span>x12 over 10m<span class=o>)</span>    kubelet            MountVolume.SetUp failed <span class=k>for</span> volume <span class=s2>&#34;test-volume&#34;</span> : hostPath <span class=nb>type</span> check failed: /data is not a directory
</span></span><span class=line><span class=cl>  Warning  FailedMount  72s                    kubelet            Unable to attach or mount volumes: unmounted <span class=nv>volumes</span><span class=o>=[</span>test-volume<span class=o>]</span>, unattached <span class=nv>volumes</span><span class=o>=[</span>default-token-dxh92 test-volume<span class=o>]</span>: timed out waiting <span class=k>for</span> the condition
</span></span></code></pre></td></tr></table></div></div><h3 id=pvc一直是pending状态>pvc一直是pending状态</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. pvc一直是pending状态</span>
</span></span><span class=line><span class=cl>&gt; kubectl get pvc
</span></span><span class=line><span class=cl>NAME        STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class=line><span class=cl>hello-pvc   Pending                                                     73s
</span></span><span class=line><span class=cl><span class=c1># 2. 使用 kubectl describe 排查问题</span>
</span></span><span class=line><span class=cl>&gt; kubectl describe pvc hello-pvc                                                                                 ─╯
</span></span><span class=line><span class=cl>Name:          hello-pvc
</span></span><span class=line><span class=cl>Namespace:     default
</span></span><span class=line><span class=cl>StorageClass:
</span></span><span class=line><span class=cl>Status:        Pending
</span></span><span class=line><span class=cl>Volume:
</span></span><span class=line><span class=cl>Labels:        &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:   &lt;none&gt;
</span></span><span class=line><span class=cl>Finalizers:    <span class=o>[</span>kubernetes.io/pvc-protection<span class=o>]</span>
</span></span><span class=line><span class=cl>Capacity:
</span></span><span class=line><span class=cl>Access Modes:
</span></span><span class=line><span class=cl>VolumeMode:    Filesystem
</span></span><span class=line><span class=cl>Used By:       &lt;none&gt;
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type    Reason         Age                  From                         Message
</span></span><span class=line><span class=cl>  ----    ------         ----                 ----                         -------
</span></span><span class=line><span class=cl>  Normal  FailedBinding  2s <span class=o>(</span>x13 over 2m53s<span class=o>)</span>  persistentvolume-controller  no persistent volumes available <span class=k>for</span> this claim and no storage class is <span class=nb>set</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-07-20</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/kubernetes-example/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://iamwlb.github.io/kubernetes-example/ data-title="Kubernetes Example" data-hashtags=Kubernetes><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://iamwlb.github.io/kubernetes-example/ data-hashtag=Kubernetes><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://iamwlb.github.io/kubernetes-example/ data-title="Kubernetes Example"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://iamwlb.github.io/kubernetes-example/ data-title="Kubernetes Example"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://iamwlb.github.io/kubernetes-example/ data-title="Kubernetes Example"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/kubernetes/>Kubernetes</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/first_post/ class=next rel=next title=First_post>First_post<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><center>This website has been running for <span id=span_dt_dt style=color:#0196e3></span>
<script language=javascript>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("7/30/2023 00:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=24*60*60*1e3,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=(e_daysold-daysold)*24,hrsold=Math.floor(e_hrsold),e_minsold=(e_hrsold-hrsold)*60,minsold=Math.floor((e_hrsold-hrsold)*60),seconds=Math.floor((e_minsold-minsold)*60),span_dt_dt.innerHTML=""+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_date_time()</script></center><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://iamwlb.github.io target=_blank>Libing Wang</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{gitalk:{admin:["iamwlb"],clientID:"eb0836324e42452bad17",clientSecret:"e2c93180b1f115740c96e248020fb490422348e9",id:"2021-07-20T13:23:05+08:00",owner:"iamwlb",repo:"blog-comment",title:"Kubernetes Example"}},search:{algoliaAppID:"YGZ8352V6U",algoliaIndex:"iamwlb-github-io",algoliaSearchKey:"fefc1a11fc90135f40a263e2af024563",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ZML4SJ5J7",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-0ZML4SJ5J7" async></script></body></html>